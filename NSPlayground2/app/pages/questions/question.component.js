"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var router_1 = require("nativescript-angular/router");
var page_1 = require("ui/page");
var animation_1 = require("ui/animation");
var platform_1 = require("platform");
var app = require("application");
var question_slides_service_1 = require("./question-slides.service");
var router_2 = require("@angular/router");
var QuestionComponent = /** @class */ (function () {
    function QuestionComponent(page, nav, activatedRoute, questionService) {
        this.page = page;
        this.nav = nav;
        this.activatedRoute = activatedRoute;
        this.questionService = questionService;
        //--------------//
        this.listeQuestion = [];
        this.currentSlideNum = 0;
        this.slideCount = 3;
        this.screenWidth = platform_1.screen.mainScreen.widthDIPs;
        // Span the background under status bar on Android
        if (platform_1.isAndroid && platform_1.device.sdkVersion >= '21') {
            var View = android.view.View;
            var window = app.android.startActivity.getWindow();
            window.setStatusBarColor(0x000000);
            var decorView = window.getDecorView();
            decorView.setSystemUiVisibility(View.SYSTEM_UI_FLAG_LAYOUT_STABLE
                | View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION
                | View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN
                | View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY);
        }
    }
    QuestionComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.id_test = this.activatedRoute.snapshot.paramMap.get('id_test');
        this.questionService.getListQuestions(this.id_test).subscribe(function (data) {
            _this.listeQuestion = data;
            _this.slideCount = _this.listeQuestion.length;
            console.log("zaher mizyan question");
            console.log(_this.listeQuestion);
            _this.slideView = _this.slideElement.nativeElement;
            var gridViewC = _this.gridViewC.nativeElement;
            _this.slideView.content = (_this.slidesView = gridViewC);
            setTimeout(function () {
                for (var i = 1; i < _this.slideCount; i++)
                    _this.slidesView.getChildAt(i).opacity = 0;
            }, 30);
        }, function (error) {
            console.log("error question");
        });
        //---------------------------//
        this.page.actionBarHidden = true;
        this.page.cssClasses.add("welcome-page-background");
        this.page.backgroundSpanUnderStatusBar = true;
    };
    QuestionComponent.prototype.skipIntro = function () {
        // this.nav.navigate(["/home"], { clearHistory: true });
        // this.nav.navigate(["/home"]);
    };
    QuestionComponent.prototype.onSwipe = function (args) {
        var prevSlideNum = this.currentSlideNum;
        var count = this.slideCount;
        if (args.direction == 2) {
            this.currentSlideNum = (this.currentSlideNum + 1) % count;
        }
        else if (args.direction == 1) {
            this.currentSlideNum = (this.currentSlideNum - 1 + count) % count;
        }
        else {
            // We are interested in left and right directions
            return;
        }
        var currSlide = this.slidesView.getChildAt(prevSlideNum);
        var nextSlide = this.slidesView.getChildAt(this.currentSlideNum);
        this.animate(currSlide, nextSlide, args.direction);
    };
    QuestionComponent.prototype.animate = function (currSlide, nextSlide, direction) {
        nextSlide.translateX = (direction == 2 ? this.screenWidth : -this.screenWidth);
        nextSlide.opacity = 1;
        console.log(nextSlide);
        console.log(nextSlide.opacity);
        var definitions = new Array();
        var defn1 = {
            target: currSlide,
            translate: { x: (direction == 2 ? -this.screenWidth : this.screenWidth), y: 0 },
            duration: 500
        };
        definitions.push(defn1);
        var defn2 = {
            target: nextSlide,
            translate: { x: 0, y: 0 },
            duration: 500
        };
        definitions.push(defn2);
        var animationSet = new animation_1.Animation(definitions);
        animationSet.play()
            .then(function () {
            console.log("Animation finished");
        })
            .catch(function (e) {
            console.log(e.message);
        });
    };
    QuestionComponent.prototype.itemSelected = function (item) {
        console.log(item);
    };
    QuestionComponent.prototype.getSliderItemClass = function (item) {
        /*if (item == this.currentSlideNum)
            return "caro-item-dot caro-item-dot-selected";

        return "caro-item-dot";*/
    };
    QuestionComponent.prototype.getTypeQuestion = function (quest) {
        var nbR = 0;
        var nbJ = 0;
        if (quest.rep1 != null)
            nbR += 1;
        if (quest.rep2 != null)
            nbR += 1;
        if (quest.rep3 != null)
            nbR += 1;
        if (quest.rep4 != null)
            nbR += 1;
        if (quest.rep5 != null)
            nbR += 1;
        if (quest.rep6 != null)
            nbR += 1;
        if (quest.just1 != "0")
            nbJ += 1;
        if (quest.just2 != "0")
            nbJ += 1;
        if (quest.just3 != "0")
            nbJ += 1;
        if (quest.just4 != "0")
            nbJ += 1;
        if (quest.just5 != "0")
            nbJ += 1;
        if (quest.just6 != "0")
            nbJ += 1;
        if (nbR == 1 && nbJ == 1)
            return { type: "t", nPro: nbR };
        else if (nbR > 1 && nbJ == 1)
            return { type: "r", nPro: nbR };
        return { type: "c", nPro: nbR };
    };
    __decorate([
        core_1.ViewChild('slideContent'),
        __metadata("design:type", core_1.ElementRef)
    ], QuestionComponent.prototype, "slideElement", void 0);
    __decorate([
        core_1.ViewChild('gridViewC'),
        __metadata("design:type", core_1.ElementRef)
    ], QuestionComponent.prototype, "gridViewC", void 0);
    QuestionComponent = __decorate([
        core_1.Component({
            selector: "question",
            moduleId: module.id,
            templateUrl: "./question.component.html",
            styleUrls: ["./question.component.css"]
        }),
        __metadata("design:paramtypes", [page_1.Page,
            router_1.RouterExtensions,
            router_2.ActivatedRoute,
            question_slides_service_1.QuestionSlidesService])
    ], QuestionComponent);
    return QuestionComponent;
}());
exports.QuestionComponent = QuestionComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVlc3Rpb24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicXVlc3Rpb24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQWdGO0FBQ2hGLHNEQUErRDtBQUUvRCxnQ0FBa0Q7QUFHbEQsMENBQThEO0FBQzlELHFDQUFxRDtBQUdyRCxpQ0FBbUM7QUFJbkMscUVBQWtFO0FBQ2xFLDBDQUFpRDtBQWFqRDtJQWtCSSwyQkFDWSxJQUFVLEVBQ1YsR0FBcUIsRUFDckIsY0FBOEIsRUFDOUIsZUFBc0M7UUFIdEMsU0FBSSxHQUFKLElBQUksQ0FBTTtRQUNWLFFBQUcsR0FBSCxHQUFHLENBQWtCO1FBQ3JCLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUM5QixvQkFBZSxHQUFmLGVBQWUsQ0FBdUI7UUFyQmxELGtCQUFrQjtRQUNsQixrQkFBYSxHQUFHLEVBQUUsQ0FBQTtRQU1WLG9CQUFlLEdBQVcsQ0FBQyxDQUFDO1FBQzVCLGVBQVUsR0FBRyxDQUFDLENBQUM7UUFlbkIsSUFBSSxDQUFDLFdBQVcsR0FBRyxpQkFBTSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUM7UUFFL0Msa0RBQWtEO1FBQ2xELElBQUksb0JBQVMsSUFBSSxpQkFBTSxDQUFDLFVBQVUsSUFBSSxJQUFJLEVBQUU7WUFDeEMsSUFBSSxJQUFJLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7WUFDN0IsSUFBSSxNQUFNLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDbkQsTUFBTSxDQUFDLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBRW5DLElBQUksU0FBUyxHQUFHLE1BQU0sQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUN0QyxTQUFTLENBQUMscUJBQXFCLENBQzNCLElBQUksQ0FBQyw0QkFBNEI7a0JBQy9CLElBQUksQ0FBQyxxQ0FBcUM7a0JBQzFDLElBQUksQ0FBQyxnQ0FBZ0M7a0JBQ3JDLElBQUksQ0FBQywrQkFBK0IsQ0FBQyxDQUFDO1NBQy9DO0lBQ0wsQ0FBQztJQUVELG9DQUFRLEdBQVI7UUFBQSxpQkF5QkM7UUF4QkcsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3BFLElBQUksQ0FBQyxlQUFlLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLFNBQVMsQ0FDekQsVUFBQSxJQUFJO1lBQ0EsS0FBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUM7WUFDMUIsS0FBSSxDQUFDLFVBQVUsR0FBRyxLQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQztZQUM1QyxPQUFPLENBQUMsR0FBRyxDQUFDLHVCQUF1QixDQUFDLENBQUE7WUFDcEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFJLENBQUMsYUFBYSxDQUFDLENBQUE7WUFDL0IsS0FBSSxDQUFDLFNBQVMsR0FBRyxLQUFJLENBQUMsWUFBWSxDQUFDLGFBQWEsQ0FBQztZQUNqRCxJQUFJLFNBQVMsR0FBZSxLQUFJLENBQUMsU0FBUyxDQUFDLGFBQTJCLENBQUM7WUFDdkUsS0FBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLEdBQUcsQ0FBQyxLQUFJLENBQUMsVUFBVSxHQUFHLFNBQVMsQ0FBQyxDQUFDO1lBQ3ZELFVBQVUsQ0FBQztnQkFDUCxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsS0FBSSxDQUFDLFVBQVUsRUFBRSxDQUFDLEVBQUU7b0JBQ3BDLEtBQUksQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQUM7WUFDbEQsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFBO1FBQ1YsQ0FBQyxFQUNELFVBQUEsS0FBSztZQUNELE9BQU8sQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUNsQyxDQUFDLENBQ0osQ0FBQztRQUNGLCtCQUErQjtRQUMvQixJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUM7UUFDakMsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLHlCQUF5QixDQUFDLENBQUM7UUFDcEQsSUFBSSxDQUFDLElBQUksQ0FBQyw0QkFBNEIsR0FBRyxJQUFJLENBQUM7SUFFbEQsQ0FBQztJQUVELHFDQUFTLEdBQVQ7UUFDSSx3REFBd0Q7UUFDeEQsZ0NBQWdDO0lBQ3BDLENBQUM7SUFFRCxtQ0FBTyxHQUFQLFVBQVEsSUFBMkI7UUFFL0IsSUFBSSxZQUFZLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQztRQUN4QyxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDO1FBRTVCLElBQUksSUFBSSxDQUFDLFNBQVMsSUFBSSxDQUFDLEVBQUU7WUFDckIsSUFBSSxDQUFDLGVBQWUsR0FBRyxDQUFDLElBQUksQ0FBQyxlQUFlLEdBQUcsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDO1NBQzdEO2FBQU0sSUFBSSxJQUFJLENBQUMsU0FBUyxJQUFJLENBQUMsRUFBRTtZQUM1QixJQUFJLENBQUMsZUFBZSxHQUFHLENBQUMsSUFBSSxDQUFDLGVBQWUsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDLEdBQUcsS0FBSyxDQUFDO1NBQ3JFO2FBQU07WUFDSCxpREFBaUQ7WUFDakQsT0FBTztTQUNWO1FBRUQsSUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDM0QsSUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBR25FLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDdkQsQ0FBQztJQUVELG1DQUFPLEdBQVAsVUFBUSxTQUFTLEVBQUUsU0FBUyxFQUFFLFNBQVM7UUFFbkMsU0FBUyxDQUFDLFVBQVUsR0FBRyxDQUFDLFNBQVMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBRS9FLFNBQVMsQ0FBQyxPQUFPLEdBQUcsQ0FBQyxDQUFDO1FBQ3RCLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUE7UUFDdEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUE7UUFDOUIsSUFBSSxXQUFXLEdBQUcsSUFBSSxLQUFLLEVBQXVCLENBQUM7UUFDbkQsSUFBSSxLQUFLLEdBQXdCO1lBQzdCLE1BQU0sRUFBRSxTQUFTO1lBQ2pCLFNBQVMsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLFNBQVMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUU7WUFDL0UsUUFBUSxFQUFFLEdBQUc7U0FDaEIsQ0FBQztRQUNGLFdBQVcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFFeEIsSUFBSSxLQUFLLEdBQXdCO1lBQzdCLE1BQU0sRUFBRSxTQUFTO1lBQ2pCLFNBQVMsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRTtZQUN6QixRQUFRLEVBQUUsR0FBRztTQUNoQixDQUFDO1FBQ0YsV0FBVyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUV4QixJQUFJLFlBQVksR0FBRyxJQUFJLHFCQUFTLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDOUMsWUFBWSxDQUFDLElBQUksRUFBRTthQUNkLElBQUksQ0FBQztZQUNGLE9BQU8sQ0FBQyxHQUFHLENBQUMsb0JBQW9CLENBQUMsQ0FBQztRQUN0QyxDQUFDLENBQUM7YUFDRCxLQUFLLENBQUMsVUFBQyxDQUFDO1lBQ0wsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDM0IsQ0FBQyxDQUFDLENBQUM7SUFDWCxDQUFDO0lBRUQsd0NBQVksR0FBWixVQUFhLElBQVk7UUFFckIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUNyQixDQUFDO0lBRUQsOENBQWtCLEdBQWxCLFVBQW1CLElBQVk7UUFDM0I7OztpQ0FHeUI7SUFDN0IsQ0FBQztJQUVELDJDQUFlLEdBQWYsVUFBZ0IsS0FBSztRQUNoQixJQUFJLEdBQUcsR0FBRyxDQUFDLENBQUM7UUFDWixJQUFJLEdBQUcsR0FBRyxDQUFDLENBQUM7UUFFYixJQUFHLEtBQUssQ0FBQyxJQUFJLElBQUUsSUFBSTtZQUFFLEdBQUcsSUFBRyxDQUFDLENBQUE7UUFDNUIsSUFBRyxLQUFLLENBQUMsSUFBSSxJQUFFLElBQUk7WUFBRSxHQUFHLElBQUcsQ0FBQyxDQUFBO1FBQzVCLElBQUcsS0FBSyxDQUFDLElBQUksSUFBRSxJQUFJO1lBQUUsR0FBRyxJQUFHLENBQUMsQ0FBQTtRQUM1QixJQUFHLEtBQUssQ0FBQyxJQUFJLElBQUUsSUFBSTtZQUFFLEdBQUcsSUFBRyxDQUFDLENBQUE7UUFDNUIsSUFBRyxLQUFLLENBQUMsSUFBSSxJQUFFLElBQUk7WUFBRSxHQUFHLElBQUcsQ0FBQyxDQUFBO1FBQzVCLElBQUcsS0FBSyxDQUFDLElBQUksSUFBRSxJQUFJO1lBQUUsR0FBRyxJQUFHLENBQUMsQ0FBQTtRQUU1QixJQUFHLEtBQUssQ0FBQyxLQUFLLElBQUUsR0FBRztZQUFFLEdBQUcsSUFBRyxDQUFDLENBQUE7UUFDNUIsSUFBRyxLQUFLLENBQUMsS0FBSyxJQUFFLEdBQUc7WUFBRSxHQUFHLElBQUcsQ0FBQyxDQUFBO1FBQzVCLElBQUcsS0FBSyxDQUFDLEtBQUssSUFBRSxHQUFHO1lBQUUsR0FBRyxJQUFHLENBQUMsQ0FBQTtRQUM1QixJQUFHLEtBQUssQ0FBQyxLQUFLLElBQUUsR0FBRztZQUFFLEdBQUcsSUFBRyxDQUFDLENBQUE7UUFDNUIsSUFBRyxLQUFLLENBQUMsS0FBSyxJQUFFLEdBQUc7WUFBRSxHQUFHLElBQUcsQ0FBQyxDQUFBO1FBQzVCLElBQUcsS0FBSyxDQUFDLEtBQUssSUFBRSxHQUFHO1lBQUUsR0FBRyxJQUFHLENBQUMsQ0FBQTtRQUM1QixJQUFJLEdBQUcsSUFBRSxDQUFDLElBQUksR0FBRyxJQUFFLENBQUM7WUFBRSxPQUFPLEVBQUMsSUFBSSxFQUFDLEdBQUcsRUFBQyxJQUFJLEVBQUMsR0FBRyxFQUFDLENBQUE7YUFDM0MsSUFBSSxHQUFHLEdBQUMsQ0FBQyxJQUFJLEdBQUcsSUFBRSxDQUFDO1lBQUUsT0FBTyxFQUFDLElBQUksRUFBQyxHQUFHLEVBQUMsSUFBSSxFQUFDLEdBQUcsRUFBQyxDQUFBO1FBQ3BELE9BQU8sRUFBQyxJQUFJLEVBQUMsR0FBRyxFQUFDLElBQUksRUFBQyxHQUFHLEVBQUMsQ0FBQTtJQUM5QixDQUFDO0lBaEowQjtRQUExQixnQkFBUyxDQUFDLGNBQWMsQ0FBQztrQ0FBZSxpQkFBVTsyREFBQztJQUM1QjtRQUF2QixnQkFBUyxDQUFDLFdBQVcsQ0FBQztrQ0FBWSxpQkFBVTt3REFBQztJQWZyQyxpQkFBaUI7UUFON0IsZ0JBQVMsQ0FBQztZQUNQLFFBQVEsRUFBRSxVQUFVO1lBQ3BCLFFBQVEsRUFBRSxNQUFNLENBQUMsRUFBRTtZQUNuQixXQUFXLEVBQUUsMkJBQTJCO1lBQ3hDLFNBQVMsRUFBRSxDQUFDLDBCQUEwQixDQUFDO1NBQzFDLENBQUM7eUNBb0JvQixXQUFJO1lBQ0wseUJBQWdCO1lBQ0wsdUJBQWM7WUFDYiwrQ0FBcUI7T0F0QnpDLGlCQUFpQixDQStKN0I7SUFBRCx3QkFBQztDQUFBLEFBL0pELElBK0pDO0FBL0pZLDhDQUFpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBWaWV3Q2hpbGQsIEVsZW1lbnRSZWYsIElucHV0IH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuaW1wb3J0IHsgUm91dGVyRXh0ZW5zaW9ucyB9IGZyb20gXCJuYXRpdmVzY3JpcHQtYW5ndWxhci9yb3V0ZXJcIjtcclxuXHJcbmltcG9ydCB7IFBhZ2UsIENvbnRlbnRWaWV3LCBWaWV3IH0gZnJvbSBcInVpL3BhZ2VcIjtcclxuaW1wb3J0IHsgU3dpcGVHZXN0dXJlRXZlbnREYXRhIH0gZnJvbSBcInVpL2dlc3R1cmVzL2dlc3R1cmVzXCI7XHJcbmltcG9ydCB7IEdyaWRMYXlvdXQsIEdyaWRVbml0VHlwZSwgSXRlbVNwZWMgfSBmcm9tIFwidWkvbGF5b3V0cy9ncmlkLWxheW91dFwiO1xyXG5pbXBvcnQgeyBBbmltYXRpb25EZWZpbml0aW9uLCBBbmltYXRpb24gfSBmcm9tICd1aS9hbmltYXRpb24nO1xyXG5pbXBvcnQgeyBzY3JlZW4sIGlzQW5kcm9pZCwgZGV2aWNlIH0gZnJvbSBcInBsYXRmb3JtXCI7XHJcblxyXG5cclxuaW1wb3J0ICogYXMgYXBwIGZyb20gXCJhcHBsaWNhdGlvblwiO1xyXG5pbXBvcnQgKiBhcyBmcyBmcm9tIFwiZmlsZS1zeXN0ZW1cIjtcclxuaW1wb3J0ICogYXMgYnVpbGRlciBmcm9tIFwidWkvYnVpbGRlclwiO1xyXG5cclxuaW1wb3J0IHsgUXVlc3Rpb25TbGlkZXNTZXJ2aWNlIH0gZnJvbSBcIi4vcXVlc3Rpb24tc2xpZGVzLnNlcnZpY2VcIjtcclxuaW1wb3J0IHsgQWN0aXZhdGVkUm91dGUgfSBmcm9tIFwiQGFuZ3VsYXIvcm91dGVyXCI7XHJcbmltcG9ydCB7IFN0YWNrTGF5b3V0IH0gZnJvbSBcInRucy1jb3JlLW1vZHVsZXMvdWkvbGF5b3V0cy9zdGFjay1sYXlvdXQvc3RhY2stbGF5b3V0XCI7XHJcblxyXG5cclxuXHJcbmRlY2xhcmUgdmFyIGFuZHJvaWQ6IGFueTtcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6IFwicXVlc3Rpb25cIixcclxuICAgIG1vZHVsZUlkOiBtb2R1bGUuaWQsXHJcbiAgICB0ZW1wbGF0ZVVybDogXCIuL3F1ZXN0aW9uLmNvbXBvbmVudC5odG1sXCIsXHJcbiAgICBzdHlsZVVybHM6IFtcIi4vcXVlc3Rpb24uY29tcG9uZW50LmNzc1wiXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgUXVlc3Rpb25Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gICAgLy8tLS0tLS0tLS0tLS0tLS8vXHJcbiAgICBsaXN0ZVF1ZXN0aW9uID0gW11cclxuXHJcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS8vXHJcbiAgICAvLyBwcml2YXRlIHNsaWRlc1BhdGggPSAncGFnZXMvcXVlc3Rpb24vc2xpZGVzJztcclxuICAgIC8vIHByaXZhdGUgc2xpZGVGaWxlcyA9IFsnc2xpZGUxLnhtbCcsICdzbGlkZTIueG1sJywgJ3NsaWRlMy54bWwnXTtcclxuICAgIHB1YmxpYyBpZF90ZXN0O1xyXG4gICAgcHJpdmF0ZSBjdXJyZW50U2xpZGVOdW06IG51bWJlciA9IDA7XHJcbiAgICBwcml2YXRlIHNsaWRlQ291bnQgPSAzO1xyXG5cclxuICAgIHByaXZhdGUgc2NyZWVuV2lkdGg7XHJcbiAgICBwcml2YXRlIHNsaWRlc1ZpZXc6IEdyaWRMYXlvdXQ7XHJcblxyXG4gICAgQFZpZXdDaGlsZCgnc2xpZGVDb250ZW50Jykgc2xpZGVFbGVtZW50OiBFbGVtZW50UmVmO1xyXG4gICAgQFZpZXdDaGlsZCgnZ3JpZFZpZXdDJykgZ3JpZFZpZXdDOiBFbGVtZW50UmVmO1xyXG4gICAgcHJpdmF0ZSBzbGlkZVZpZXc6IENvbnRlbnRWaWV3O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgcGFnZTogUGFnZSxcclxuICAgICAgICBwcml2YXRlIG5hdjogUm91dGVyRXh0ZW5zaW9ucyxcclxuICAgICAgICBwcml2YXRlIGFjdGl2YXRlZFJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSxcclxuICAgICAgICBwcml2YXRlIHF1ZXN0aW9uU2VydmljZTogUXVlc3Rpb25TbGlkZXNTZXJ2aWNlXHJcbiAgICApIHtcclxuICAgICAgICB0aGlzLnNjcmVlbldpZHRoID0gc2NyZWVuLm1haW5TY3JlZW4ud2lkdGhESVBzO1xyXG5cclxuICAgICAgICAvLyBTcGFuIHRoZSBiYWNrZ3JvdW5kIHVuZGVyIHN0YXR1cyBiYXIgb24gQW5kcm9pZFxyXG4gICAgICAgIGlmIChpc0FuZHJvaWQgJiYgZGV2aWNlLnNka1ZlcnNpb24gPj0gJzIxJykge1xyXG4gICAgICAgICAgICB2YXIgVmlldyA9IGFuZHJvaWQudmlldy5WaWV3O1xyXG4gICAgICAgICAgICB2YXIgd2luZG93ID0gYXBwLmFuZHJvaWQuc3RhcnRBY3Rpdml0eS5nZXRXaW5kb3coKTtcclxuICAgICAgICAgICAgd2luZG93LnNldFN0YXR1c0JhckNvbG9yKDB4MDAwMDAwKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBkZWNvclZpZXcgPSB3aW5kb3cuZ2V0RGVjb3JWaWV3KCk7XHJcbiAgICAgICAgICAgIGRlY29yVmlldy5zZXRTeXN0ZW1VaVZpc2liaWxpdHkoXHJcbiAgICAgICAgICAgICAgICBWaWV3LlNZU1RFTV9VSV9GTEFHX0xBWU9VVF9TVEFCTEVcclxuICAgICAgICAgICAgICAgIHwgVmlldy5TWVNURU1fVUlfRkxBR19MQVlPVVRfSElERV9OQVZJR0FUSU9OXHJcbiAgICAgICAgICAgICAgICB8IFZpZXcuU1lTVEVNX1VJX0ZMQUdfTEFZT1VUX0ZVTExTQ1JFRU5cclxuICAgICAgICAgICAgICAgIHwgVmlldy5TWVNURU1fVUlfRkxBR19JTU1FUlNJVkVfU1RJQ0tZKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgdGhpcy5pZF90ZXN0ID0gdGhpcy5hY3RpdmF0ZWRSb3V0ZS5zbmFwc2hvdC5wYXJhbU1hcC5nZXQoJ2lkX3Rlc3QnKTtcclxuICAgICAgICB0aGlzLnF1ZXN0aW9uU2VydmljZS5nZXRMaXN0UXVlc3Rpb25zKHRoaXMuaWRfdGVzdCkuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICBkYXRhID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMubGlzdGVRdWVzdGlvbiA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNsaWRlQ291bnQgPSB0aGlzLmxpc3RlUXVlc3Rpb24ubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJ6YWhlciBtaXp5YW4gcXVlc3Rpb25cIilcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMubGlzdGVRdWVzdGlvbilcclxuICAgICAgICAgICAgICAgIHRoaXMuc2xpZGVWaWV3ID0gdGhpcy5zbGlkZUVsZW1lbnQubmF0aXZlRWxlbWVudDtcclxuICAgICAgICAgICAgICAgIGxldCBncmlkVmlld0M6IEdyaWRMYXlvdXQgPSB0aGlzLmdyaWRWaWV3Qy5uYXRpdmVFbGVtZW50IGFzIEdyaWRMYXlvdXQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNsaWRlVmlldy5jb250ZW50ID0gKHRoaXMuc2xpZGVzVmlldyA9IGdyaWRWaWV3Qyk7XHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHRoaXMuc2xpZGVDb3VudDsgaSsrKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNsaWRlc1ZpZXcuZ2V0Q2hpbGRBdChpKS5vcGFjaXR5ID0gMDtcclxuICAgICAgICAgICAgICAgIH0sIDMwKVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBlcnJvciA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImVycm9yIHF1ZXN0aW9uXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKTtcclxuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS8vXHJcbiAgICAgICAgdGhpcy5wYWdlLmFjdGlvbkJhckhpZGRlbiA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5wYWdlLmNzc0NsYXNzZXMuYWRkKFwid2VsY29tZS1wYWdlLWJhY2tncm91bmRcIik7XHJcbiAgICAgICAgdGhpcy5wYWdlLmJhY2tncm91bmRTcGFuVW5kZXJTdGF0dXNCYXIgPSB0cnVlO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBza2lwSW50cm8oKSB7XHJcbiAgICAgICAgLy8gdGhpcy5uYXYubmF2aWdhdGUoW1wiL2hvbWVcIl0sIHsgY2xlYXJIaXN0b3J5OiB0cnVlIH0pO1xyXG4gICAgICAgIC8vIHRoaXMubmF2Lm5hdmlnYXRlKFtcIi9ob21lXCJdKTtcclxuICAgIH1cclxuXHJcbiAgICBvblN3aXBlKGFyZ3M6IFN3aXBlR2VzdHVyZUV2ZW50RGF0YSkge1xyXG5cclxuICAgICAgICBsZXQgcHJldlNsaWRlTnVtID0gdGhpcy5jdXJyZW50U2xpZGVOdW07XHJcbiAgICAgICAgbGV0IGNvdW50ID0gdGhpcy5zbGlkZUNvdW50O1xyXG5cclxuICAgICAgICBpZiAoYXJncy5kaXJlY3Rpb24gPT0gMikge1xyXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRTbGlkZU51bSA9ICh0aGlzLmN1cnJlbnRTbGlkZU51bSArIDEpICUgY291bnQ7XHJcbiAgICAgICAgfSBlbHNlIGlmIChhcmdzLmRpcmVjdGlvbiA9PSAxKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFNsaWRlTnVtID0gKHRoaXMuY3VycmVudFNsaWRlTnVtIC0gMSArIGNvdW50KSAlIGNvdW50O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIFdlIGFyZSBpbnRlcmVzdGVkIGluIGxlZnQgYW5kIHJpZ2h0IGRpcmVjdGlvbnNcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgY3VyclNsaWRlID0gdGhpcy5zbGlkZXNWaWV3LmdldENoaWxkQXQocHJldlNsaWRlTnVtKTtcclxuICAgICAgICBjb25zdCBuZXh0U2xpZGUgPSB0aGlzLnNsaWRlc1ZpZXcuZ2V0Q2hpbGRBdCh0aGlzLmN1cnJlbnRTbGlkZU51bSk7XHJcblxyXG5cclxuICAgICAgICB0aGlzLmFuaW1hdGUoY3VyclNsaWRlLCBuZXh0U2xpZGUsIGFyZ3MuZGlyZWN0aW9uKTtcclxuICAgIH1cclxuXHJcbiAgICBhbmltYXRlKGN1cnJTbGlkZSwgbmV4dFNsaWRlLCBkaXJlY3Rpb24pIHtcclxuXHJcbiAgICAgICAgbmV4dFNsaWRlLnRyYW5zbGF0ZVggPSAoZGlyZWN0aW9uID09IDIgPyB0aGlzLnNjcmVlbldpZHRoIDogLXRoaXMuc2NyZWVuV2lkdGgpO1xyXG5cclxuICAgICAgICBuZXh0U2xpZGUub3BhY2l0eSA9IDE7XHJcbiAgICAgICAgY29uc29sZS5sb2cobmV4dFNsaWRlKVxyXG4gICAgICAgIGNvbnNvbGUubG9nKG5leHRTbGlkZS5vcGFjaXR5KVxyXG4gICAgICAgIHZhciBkZWZpbml0aW9ucyA9IG5ldyBBcnJheTxBbmltYXRpb25EZWZpbml0aW9uPigpO1xyXG4gICAgICAgIHZhciBkZWZuMTogQW5pbWF0aW9uRGVmaW5pdGlvbiA9IHtcclxuICAgICAgICAgICAgdGFyZ2V0OiBjdXJyU2xpZGUsXHJcbiAgICAgICAgICAgIHRyYW5zbGF0ZTogeyB4OiAoZGlyZWN0aW9uID09IDIgPyAtdGhpcy5zY3JlZW5XaWR0aCA6IHRoaXMuc2NyZWVuV2lkdGgpLCB5OiAwIH0sXHJcbiAgICAgICAgICAgIGR1cmF0aW9uOiA1MDBcclxuICAgICAgICB9O1xyXG4gICAgICAgIGRlZmluaXRpb25zLnB1c2goZGVmbjEpO1xyXG5cclxuICAgICAgICB2YXIgZGVmbjI6IEFuaW1hdGlvbkRlZmluaXRpb24gPSB7XHJcbiAgICAgICAgICAgIHRhcmdldDogbmV4dFNsaWRlLFxyXG4gICAgICAgICAgICB0cmFuc2xhdGU6IHsgeDogMCwgeTogMCB9LFxyXG4gICAgICAgICAgICBkdXJhdGlvbjogNTAwXHJcbiAgICAgICAgfTtcclxuICAgICAgICBkZWZpbml0aW9ucy5wdXNoKGRlZm4yKTtcclxuXHJcbiAgICAgICAgdmFyIGFuaW1hdGlvblNldCA9IG5ldyBBbmltYXRpb24oZGVmaW5pdGlvbnMpO1xyXG4gICAgICAgIGFuaW1hdGlvblNldC5wbGF5KClcclxuICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJBbmltYXRpb24gZmluaXNoZWRcIik7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaXRlbVNlbGVjdGVkKGl0ZW06IG51bWJlcikge1xyXG5cclxuICAgICAgICBjb25zb2xlLmxvZyhpdGVtKVxyXG4gICAgfVxyXG5cclxuICAgIGdldFNsaWRlckl0ZW1DbGFzcyhpdGVtOiBudW1iZXIpIHtcclxuICAgICAgICAvKmlmIChpdGVtID09IHRoaXMuY3VycmVudFNsaWRlTnVtKVxyXG4gICAgICAgICAgICByZXR1cm4gXCJjYXJvLWl0ZW0tZG90IGNhcm8taXRlbS1kb3Qtc2VsZWN0ZWRcIjtcclxuXHJcbiAgICAgICAgcmV0dXJuIFwiY2Fyby1pdGVtLWRvdFwiOyovXHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VHlwZVF1ZXN0aW9uKHF1ZXN0KXtcclxuICAgICAgICAgbGV0IG5iUiA9IDA7XHJcbiAgICAgICAgIGxldCBuYkogPSAwO1xyXG5cclxuICAgICAgICBpZihxdWVzdC5yZXAxIT1udWxsKSBuYlIgKz0xXHJcbiAgICAgICAgaWYocXVlc3QucmVwMiE9bnVsbCkgbmJSICs9MVxyXG4gICAgICAgIGlmKHF1ZXN0LnJlcDMhPW51bGwpIG5iUiArPTFcclxuICAgICAgICBpZihxdWVzdC5yZXA0IT1udWxsKSBuYlIgKz0xXHJcbiAgICAgICAgaWYocXVlc3QucmVwNSE9bnVsbCkgbmJSICs9MVxyXG4gICAgICAgIGlmKHF1ZXN0LnJlcDYhPW51bGwpIG5iUiArPTFcclxuXHJcbiAgICAgICAgaWYocXVlc3QuanVzdDEhPVwiMFwiKSBuYkogKz0xXHJcbiAgICAgICAgaWYocXVlc3QuanVzdDIhPVwiMFwiKSBuYkogKz0xXHJcbiAgICAgICAgaWYocXVlc3QuanVzdDMhPVwiMFwiKSBuYkogKz0xXHJcbiAgICAgICAgaWYocXVlc3QuanVzdDQhPVwiMFwiKSBuYkogKz0xXHJcbiAgICAgICAgaWYocXVlc3QuanVzdDUhPVwiMFwiKSBuYkogKz0xXHJcbiAgICAgICAgaWYocXVlc3QuanVzdDYhPVwiMFwiKSBuYkogKz0xXHJcbiAgICAgICAgaWYgKG5iUj09MSAmJiBuYko9PTEpIHJldHVybiB7dHlwZTpcInRcIixuUHJvOm5iUn1cclxuICAgICAgICBlbHNlIGlmIChuYlI+MSAmJiBuYko9PTEpIHJldHVybiB7dHlwZTpcInJcIixuUHJvOm5iUn1cclxuICAgICAgICByZXR1cm4ge3R5cGU6XCJjXCIsblBybzpuYlJ9XHJcbiAgICB9XHJcbn0iXX0=