"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var router_1 = require("nativescript-angular/router");
var page_1 = require("ui/page");
var animation_1 = require("ui/animation");
var platform_1 = require("platform");
var app = require("application");
var question_slides_service_1 = require("./question-slides.service");
var router_2 = require("@angular/router");
var config_1 = require("../../parameters/config");
var radio_option_1 = require("../../services/radio-option");
var QuestionComponent = /** @class */ (function () {
    function QuestionComponent(page, nav, activatedRoute, questionService) {
        this.page = page;
        this.nav = nav;
        this.activatedRoute = activatedRoute;
        this.questionService = questionService;
        this.pathImage = config_1.Config;
        this.timeQCM = 30;
        this.radioOptions = [];
        this.currentSlideNum = 0;
        this.screenWidth = platform_1.screen.mainScreen.widthDIPs;
        // Span the background under status bar on Android
        if (platform_1.isAndroid && platform_1.device.sdkVersion >= '21') {
            var View = android.view.View;
            var window = app.android.startActivity.getWindow();
            window.setStatusBarColor(0x000000);
            var decorView = window.getDecorView();
            decorView.setSystemUiVisibility(View.SYSTEM_UI_FLAG_LAYOUT_STABLE
                | View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION
                | View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN
                | View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY);
        }
    }
    QuestionComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.id_test = this.activatedRoute.snapshot.paramMap.get('id_test');
        this.questionService.getListQuestions(this.id_test).subscribe(function (data) {
            _this.listeQuestion = data;
            _this.slideCount = _this.listeQuestion.length;
            //---------RadioButton-----------//
            _this.listeQuestion.forEach(function (item) {
                if (_this.getTypeQuestion(item).type == 'r') {
                    _this.radioOptions
                        .push(new radio_option_1.RadioOption(item.id, item.rep1, false));
                    _this.radioOptions
                        .push(new radio_option_1.RadioOption(item.id, item.rep2, false));
                    _this.radioOptions
                        .push(new radio_option_1.RadioOption(item.id, item.rep3, false));
                    _this.radioOptions
                        .push(new radio_option_1.RadioOption(item.id, item.rep4, false));
                    _this.radioOptions
                        .push(new radio_option_1.RadioOption(item.id, item.rep5, false));
                    _this.radioOptions
                        .push(new radio_option_1.RadioOption(item.id, item.rep6, false));
                }
            });
            //------------------//
            _this.slideView = _this.slideElement.nativeElement;
            var gridViewC = _this.gridViewC.nativeElement;
            _this.slideView.content = (_this.slidesView = gridViewC);
            setTimeout(function () {
                for (var i = 1; i < _this.slideCount; i++) {
                    _this.slidesView.getChildAt(i).opacity = 0;
                }
            }, 50);
        }, function (error) {
            console.log("error question");
        });
        //---------------------------//
        this.page.actionBarHidden = true;
        this.page.cssClasses.add("welcome-page-background");
        this.page.backgroundSpanUnderStatusBar = true;
        //------------time circulation --------//
        var a = setInterval(function () {
            _this.timeQCM -= 1;
            if (_this.timeQCM == 0)
                clearInterval(a);
        }, 1000);
    };
    QuestionComponent.prototype.onSwipe = function (direction) {
        var prevSlideNum = this.currentSlideNum;
        var count = this.slideCount;
        if (direction == 2) {
            this.currentSlideNum = (this.currentSlideNum + 1) % count;
        }
        else if (direction == 1) {
            this.currentSlideNum = (this.currentSlideNum - 1 + count) % count;
        }
        else {
            // We are interested in left and right directions
            return;
        }
        var currSlide = this.slidesView.getChildAt(prevSlideNum);
        var nextSlide = this.slidesView.getChildAt(this.currentSlideNum);
        console.log(this.currentSlideNum);
        this.animate(currSlide, nextSlide, direction);
    };
    QuestionComponent.prototype.animate = function (currSlide, nextSlide, direction) {
        nextSlide.translateX = (direction == 2 ? this.screenWidth : -this.screenWidth);
        nextSlide.opacity = 1;
        var definitions = new Array();
        var defn1 = {
            target: currSlide,
            translate: { x: (direction == 2 ? -this.screenWidth : this.screenWidth), y: 0 },
            duration: 500
        };
        definitions.push(defn1);
        var defn2 = {
            target: nextSlide,
            translate: { x: 0, y: 0 },
            duration: 500
        };
        definitions.push(defn2);
        var animationSet = new animation_1.Animation(definitions);
        animationSet.play()
            .then(function () {
            console.log("Animation finished");
        })
            .catch(function (e) {
            console.log(e.message);
        });
    };
    QuestionComponent.prototype.getSliderItemClass = function (item) {
        if (item == this.currentSlideNum)
            return "caro-item-dot-selected";
        return "caro-item-dot";
    };
    QuestionComponent.prototype.getTypeQuestion = function (quest) {
        var nbR = 0;
        var nbJ = 0;
        if (quest.rep1 != null)
            nbR += 1;
        if (quest.rep2 != null)
            nbR += 1;
        if (quest.rep3 != null)
            nbR += 1;
        if (quest.rep4 != null)
            nbR += 1;
        if (quest.rep5 != null)
            nbR += 1;
        if (quest.rep6 != null)
            nbR += 1;
        if (quest.just1 != "0")
            nbJ += 1;
        if (quest.just2 != "0")
            nbJ += 1;
        if (quest.just3 != "0")
            nbJ += 1;
        if (quest.just4 != "0")
            nbJ += 1;
        if (quest.just5 != "0")
            nbJ += 1;
        if (quest.just6 != "0")
            nbJ += 1;
        if (nbR == 1 && nbJ == 1)
            return { type: "t", nPro: nbR };
        else if (nbR > 1 && nbJ == 1)
            return { type: "r", nPro: nbR };
        return { type: "c", nPro: nbR };
    };
    //------Radio Button--------/
    QuestionComponent.prototype.changeCheckedRadio = function (idQ, txtR) {
        console.log(idQ + "  " + txtR);
        for (var i = 0; i < this.radioOptions.length; i++)
            if (this.radioOptions[i].idQue == idQ && this.radioOptions[i].txtRep == txtR)
                this.radioOptions[i].selected = true;
            else if (this.radioOptions[i].idQue == idQ && this.radioOptions[i].txtRep != txtR)
                this.radioOptions[i].selected = false;
        console.log(this.radioOptions);
    };
    QuestionComponent.prototype.elatRadio = function (idQ, txtR) {
        for (var i = 0; i < this.radioOptions.length; i++)
            if (this.radioOptions[i].idQue == idQ && this.radioOptions[i].txtRep == txtR)
                return this.radioOptions[i].selected || false;
        return false;
    };
    __decorate([
        core_1.ViewChild('slideContent'),
        __metadata("design:type", core_1.ElementRef)
    ], QuestionComponent.prototype, "slideElement", void 0);
    __decorate([
        core_1.ViewChild('gridViewC'),
        __metadata("design:type", core_1.ElementRef)
    ], QuestionComponent.prototype, "gridViewC", void 0);
    QuestionComponent = __decorate([
        core_1.Component({
            selector: "question",
            moduleId: module.id,
            templateUrl: "./question.component.html",
            styleUrls: ["./question.component.css"]
        }),
        __metadata("design:paramtypes", [page_1.Page,
            router_1.RouterExtensions,
            router_2.ActivatedRoute,
            question_slides_service_1.QuestionSlidesService])
    ], QuestionComponent);
    return QuestionComponent;
}());
exports.QuestionComponent = QuestionComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVlc3Rpb24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicXVlc3Rpb24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQWdGO0FBQ2hGLHNEQUErRDtBQUUvRCxnQ0FBa0Q7QUFHbEQsMENBQThEO0FBQzlELHFDQUFxRDtBQUdyRCxpQ0FBbUM7QUFJbkMscUVBQWtFO0FBQ2xFLDBDQUFpRDtBQUdqRCxrREFBaUQ7QUFHakQsNERBQTBEO0FBUzFEO0lBa0JJLDJCQUNZLElBQVUsRUFDVixHQUFxQixFQUNyQixjQUE4QixFQUM5QixlQUFzQztRQUh0QyxTQUFJLEdBQUosSUFBSSxDQUFNO1FBQ1YsUUFBRyxHQUFILEdBQUcsQ0FBa0I7UUFDckIsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBQzlCLG9CQUFlLEdBQWYsZUFBZSxDQUF1QjtRQW5CbEQsY0FBUyxHQUFHLGVBQU0sQ0FBQztRQUNuQixZQUFPLEdBQUcsRUFBRSxDQUFDO1FBQ2IsaUJBQVksR0FBRyxFQUFFLENBQUM7UUFHWCxvQkFBZSxHQUFXLENBQUMsQ0FBQztRQWdCL0IsSUFBSSxDQUFDLFdBQVcsR0FBRyxpQkFBTSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUM7UUFFL0Msa0RBQWtEO1FBQ2xELElBQUksb0JBQVMsSUFBSSxpQkFBTSxDQUFDLFVBQVUsSUFBSSxJQUFJLEVBQUU7WUFDeEMsSUFBSSxJQUFJLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7WUFDN0IsSUFBSSxNQUFNLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDbkQsTUFBTSxDQUFDLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBRW5DLElBQUksU0FBUyxHQUFHLE1BQU0sQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUN0QyxTQUFTLENBQUMscUJBQXFCLENBQzNCLElBQUksQ0FBQyw0QkFBNEI7a0JB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QUMsQ0FBQyxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUM7UUFFdEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUE7SUFDMUMsQ0FBQztJQUNELHFDQUFTLEdBQVQsVUFBVSxHQUFHLEVBQUUsSUFBSTtRQUNmLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUU7WUFDN0MsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLElBQUksSUFBSTtnQkFDNUUsT0FBUSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsSUFBSSxLQUFLLENBQUM7UUFDbkQsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQztJQWhMMEI7UUFBMUIsZ0JBQVMsQ0FBQyxjQUFjLENBQUM7a0NBQWUsaUJBQVU7MkRBQUM7SUFDNUI7UUFBdkIsZ0JBQVMsQ0FBQyxXQUFXLENBQUM7a0NBQVksaUJBQVU7d0RBQUM7SUFmckMsaUJBQWlCO1FBTjdCLGdCQUFTLENBQUM7WUFDUCxRQUFRLEVBQUUsVUFBVTtZQUNwQixRQUFRLEVBQUUsTUFBTSxDQUFDLEVBQUU7WUFDbkIsV0FBVyxFQUFFLDJCQUEyQjtZQUN4QyxTQUFTLEVBQUUsQ0FBQywwQkFBMEIsQ0FBQztTQUMxQyxDQUFDO3lDQW9Cb0IsV0FBSTtZQUNMLHlCQUFnQjtZQUNMLHVCQUFjO1lBQ2IsK0NBQXFCO09BdEJ6QyxpQkFBaUIsQ0ErTDdCO0lBQUQsd0JBQUM7Q0FBQSxBQS9MRCxJQStMQztBQS9MWSw4Q0FBaUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgVmlld0NoaWxkLCBFbGVtZW50UmVmLCBJbnB1dCB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IFJvdXRlckV4dGVuc2lvbnMgfSBmcm9tIFwibmF0aXZlc2NyaXB0LWFuZ3VsYXIvcm91dGVyXCI7XHJcblxyXG5pbXBvcnQgeyBQYWdlLCBDb250ZW50VmlldywgVmlldyB9IGZyb20gXCJ1aS9wYWdlXCI7XHJcbmltcG9ydCB7IFN3aXBlR2VzdHVyZUV2ZW50RGF0YSB9IGZyb20gXCJ1aS9nZXN0dXJlcy9nZXN0dXJlc1wiO1xyXG5pbXBvcnQgeyBHcmlkTGF5b3V0LCBHcmlkVW5pdFR5cGUsIEl0ZW1TcGVjIH0gZnJvbSBcInVpL2xheW91dHMvZ3JpZC1sYXlvdXRcIjtcclxuaW1wb3J0IHsgQW5pbWF0aW9uRGVmaW5pdGlvbiwgQW5pbWF0aW9uIH0gZnJvbSAndWkvYW5pbWF0aW9uJztcclxuaW1wb3J0IHsgc2NyZWVuLCBpc0FuZHJvaWQsIGRldmljZSB9IGZyb20gXCJwbGF0Zm9ybVwiO1xyXG5cclxuXHJcbmltcG9ydCAqIGFzIGFwcCBmcm9tIFwiYXBwbGljYXRpb25cIjtcclxuaW1wb3J0ICogYXMgZnMgZnJvbSBcImZpbGUtc3lzdGVtXCI7XHJcbmltcG9ydCAqIGFzIGJ1aWxkZXIgZnJvbSBcInVpL2J1aWxkZXJcIjtcclxuXHJcbmltcG9ydCB7IFF1ZXN0aW9uU2xpZGVzU2VydmljZSB9IGZyb20gXCIuL3F1ZXN0aW9uLXNsaWRlcy5zZXJ2aWNlXCI7XHJcbmltcG9ydCB7IEFjdGl2YXRlZFJvdXRlIH0gZnJvbSBcIkBhbmd1bGFyL3JvdXRlclwiO1xyXG5pbXBvcnQgeyBTdGFja0xheW91dCB9IGZyb20gXCJ0bnMtY29yZS1tb2R1bGVzL3VpL2xheW91dHMvc3RhY2stbGF5b3V0L3N0YWNrLWxheW91dFwiO1xyXG5pbXBvcnQgeyBRdWVzdGlvbiB9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9xdWVzdGlvblwiO1xyXG5pbXBvcnQgeyBDb25maWcgfSBmcm9tIFwiLi4vLi4vcGFyYW1ldGVycy9jb25maWdcIjtcclxuXHJcblxyXG5pbXBvcnQgeyBSYWRpb09wdGlvbiB9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9yYWRpby1vcHRpb25cIjtcclxuZGVjbGFyZSB2YXIgYW5kcm9pZDogYW55O1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogXCJxdWVzdGlvblwiLFxyXG4gICAgbW9kdWxlSWQ6IG1vZHVsZS5pZCxcclxuICAgIHRlbXBsYXRlVXJsOiBcIi4vcXVlc3Rpb24uY29tcG9uZW50Lmh0bWxcIixcclxuICAgIHN0eWxlVXJsczogW1wiLi9xdWVzdGlvbi5jb21wb25lbnQuY3NzXCJdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBRdWVzdGlvbkNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiAgICAvLy0tLS0tLS0tLS0tLS0tLy9cclxuICAgIGxpc3RlUXVlc3Rpb246IFF1ZXN0aW9uW107XHJcbiAgICBwYXRoSW1hZ2UgPSBDb25maWc7XHJcbiAgICB0aW1lUUNNID0gMzA7XHJcbiAgICByYWRpb09wdGlvbnMgPSBbXTtcclxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLy9cclxuICAgIHB1YmxpYyBpZF90ZXN0O1xyXG4gICAgcHVibGljIGN1cnJlbnRTbGlkZU51bTogbnVtYmVyID0gMDtcclxuICAgIHByaXZhdGUgc2xpZGVDb3VudDpudW1iZXI7XHJcblxyXG4gICAgcHJpdmF0ZSBzY3JlZW5XaWR0aDtcclxuICAgIHByaXZhdGUgc2xpZGVzVmlldzogR3JpZExheW91dDtcclxuXHJcbiAgICBAVmlld0NoaWxkKCdzbGlkZUNvbnRlbnQnKSBzbGlkZUVsZW1lbnQ6IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCdncmlkVmlld0MnKSBncmlkVmlld0M6IEVsZW1lbnRSZWY7XHJcbiAgICBwcml2YXRlIHNsaWRlVmlldzogQ29udGVudFZpZXc7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBwYWdlOiBQYWdlLFxyXG4gICAgICAgIHByaXZhdGUgbmF2OiBSb3V0ZXJFeHRlbnNpb25zLFxyXG4gICAgICAgIHByaXZhdGUgYWN0aXZhdGVkUm91dGU6IEFjdGl2YXRlZFJvdXRlLFxyXG4gICAgICAgIHByaXZhdGUgcXVlc3Rpb25TZXJ2aWNlOiBRdWVzdGlvblNsaWRlc1NlcnZpY2VcclxuICAgICkge1xyXG4gICAgICAgIHRoaXMuc2NyZWVuV2lkdGggPSBzY3JlZW4ubWFpblNjcmVlbi53aWR0aERJUHM7XHJcblxyXG4gICAgICAgIC8vIFNwYW4gdGhlIGJhY2tncm91bmQgdW5kZXIgc3RhdHVzIGJhciBvbiBBbmRyb2lkXHJcbiAgICAgICAgaWYgKGlzQW5kcm9pZCAmJiBkZXZpY2Uuc2RrVmVyc2lvbiA+PSAnMjEnKSB7XHJcbiAgICAgICAgICAgIHZhciBWaWV3ID0gYW5kcm9pZC52aWV3LlZpZXc7XHJcbiAgICAgICAgICAgIHZhciB3aW5kb3cgPSBhcHAuYW5kcm9pZC5zdGFydEFjdGl2aXR5LmdldFdpbmRvdygpO1xyXG4gICAgICAgICAgICB3aW5kb3cuc2V0U3RhdHVzQmFyQ29sb3IoMHgwMDAwMDApO1xyXG5cclxuICAgICAgICAgICAgdmFyIGRlY29yVmlldyA9IHdpbmRvdy5nZXREZWNvclZpZXcoKTtcclxuICAgICAgICAgICAgZGVjb3JWaWV3LnNldFN5c3RlbVVpVmlzaWJpbGl0eShcclxuICAgICAgICAgICAgICAgIFZpZXcuU1lTVEVNX1VJX0ZMQUdfTEFZT1VUX1NUQUJMRVxyXG4gICAgICAgICAgICAgICAgfCBWaWV3LlNZU1RFTV9VSV9GTEFHX0xBWU9VVF9ISURFX05BVklHQVRJT05cclxuICAgICAgICAgICAgICAgIHwgVmlldy5TWVNURU1fVUlfRkxBR19MQVlPVVRfRlVMTFNDUkVFTlxyXG4gICAgICAgICAgICAgICAgfCBWaWV3LlNZU1RFTV9VSV9GTEFHX0lNTUVSU0lWRV9TVElDS1kpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpIHtcclxuICAgICAgICB0aGlzLmlkX3Rlc3QgPSB0aGlzLmFjdGl2YXRlZFJvdXRlLnNuYXBzaG90LnBhcmFtTWFwLmdldCgnaWRfdGVzdCcpO1xyXG5cclxuICAgICAgICB0aGlzLnF1ZXN0aW9uU2VydmljZS5nZXRMaXN0UXVlc3Rpb25zKHRoaXMuaWRfdGVzdCkuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICBkYXRhID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMubGlzdGVRdWVzdGlvbiA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNsaWRlQ291bnQgPSB0aGlzLmxpc3RlUXVlc3Rpb24ubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vLS0tLS0tLS0tUmFkaW9CdXR0b24tLS0tLS0tLS0tLS8vXHJcbiAgICAgICAgICAgICAgICB0aGlzLmxpc3RlUXVlc3Rpb24uZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5nZXRUeXBlUXVlc3Rpb24oaXRlbSkudHlwZSA9PSAncicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yYWRpb09wdGlvbnNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5wdXNoKG5ldyBSYWRpb09wdGlvbihpdGVtLmlkLCBpdGVtLnJlcDEsIGZhbHNlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmFkaW9PcHRpb25zXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucHVzaChuZXcgUmFkaW9PcHRpb24oaXRlbS5pZCwgaXRlbS5yZXAyLCBmYWxzZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJhZGlvT3B0aW9uc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnB1c2gobmV3IFJhZGlvT3B0aW9uKGl0ZW0uaWQsIGl0ZW0ucmVwMywgZmFsc2UpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yYWRpb09wdGlvbnNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5wdXNoKG5ldyBSYWRpb09wdGlvbihpdGVtLmlkLCBpdGVtLnJlcDQsIGZhbHNlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmFkaW9PcHRpb25zXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucHVzaChuZXcgUmFkaW9PcHRpb24oaXRlbS5pZCwgaXRlbS5yZXA1LCBmYWxzZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJhZGlvT3B0aW9uc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnB1c2gobmV3IFJhZGlvT3B0aW9uKGl0ZW0uaWQsIGl0ZW0ucmVwNiwgZmFsc2UpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS8vXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNsaWRlVmlldyA9IHRoaXMuc2xpZGVFbGVtZW50Lm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAgICAgICAgICBsZXQgZ3JpZFZpZXdDOiBHcmlkTGF5b3V0ID0gdGhpcy5ncmlkVmlld0MubmF0aXZlRWxlbWVudCBhcyBHcmlkTGF5b3V0O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zbGlkZVZpZXcuY29udGVudCA9ICh0aGlzLnNsaWRlc1ZpZXcgPSBncmlkVmlld0MpO1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCB0aGlzLnNsaWRlQ291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNsaWRlc1ZpZXcuZ2V0Q2hpbGRBdChpKS5vcGFjaXR5ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LCA1MCk7XHJcbiAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBlcnJvciA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImVycm9yIHF1ZXN0aW9uXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKTtcclxuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS8vXHJcbiAgICAgICAgdGhpcy5wYWdlLmFjdGlvbkJhckhpZGRlbiA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5wYWdlLmNzc0NsYXNzZXMuYWRkKFwid2VsY29tZS1wYWdlLWJhY2tncm91bmRcIik7XHJcbiAgICAgICAgdGhpcy5wYWdlLmJhY2tncm91bmRTcGFuVW5kZXJTdGF0dXNCYXIgPSB0cnVlO1xyXG4gICAgICAgIC8vLS0tLS0tLS0tLS0tdGltZSBjaXJjdWxhdGlvbiAtLS0tLS0tLS8vXHJcbiAgICAgICAgdmFyIGEgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMudGltZVFDTSAtPSAxO1xyXG4gICAgICAgICAgICBpZiAodGhpcy50aW1lUUNNID09IDApXHJcbiAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKGEpO1xyXG4gICAgICAgIH0sIDEwMDApO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBvblN3aXBlKGRpcmVjdGlvbjogbnVtYmVyKSB7XHJcblxyXG4gICAgICAgIGxldCBwcmV2U2xpZGVOdW0gPSB0aGlzLmN1cnJlbnRTbGlkZU51bTtcclxuICAgICAgICBsZXQgY291bnQgPSB0aGlzLnNsaWRlQ291bnQ7XHJcblxyXG4gICAgICAgIGlmIChkaXJlY3Rpb24gPT0gMikge1xyXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRTbGlkZU51bSA9ICh0aGlzLmN1cnJlbnRTbGlkZU51bSArIDEpICUgY291bnQ7XHJcbiAgICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT0gMSkge1xyXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRTbGlkZU51bSA9ICh0aGlzLmN1cnJlbnRTbGlkZU51bSAtIDEgKyBjb3VudCkgJSBjb3VudDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBXZSBhcmUgaW50ZXJlc3RlZCBpbiBsZWZ0IGFuZCByaWdodCBkaXJlY3Rpb25zXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGN1cnJTbGlkZSA9IHRoaXMuc2xpZGVzVmlldy5nZXRDaGlsZEF0KHByZXZTbGlkZU51bSk7XHJcbiAgICAgICAgY29uc3QgbmV4dFNsaWRlID0gdGhpcy5zbGlkZXNWaWV3LmdldENoaWxkQXQodGhpcy5jdXJyZW50U2xpZGVOdW0pO1xyXG5cclxuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmN1cnJlbnRTbGlkZU51bSk7XHJcbiAgICAgICAgdGhpcy5hbmltYXRlKGN1cnJTbGlkZSwgbmV4dFNsaWRlLCBkaXJlY3Rpb24pO1xyXG4gICAgfVxyXG5cclxuICAgIGFuaW1hdGUoY3VyclNsaWRlLCBuZXh0U2xpZGUsIGRpcmVjdGlvbikge1xyXG4gICAgICAgIG5leHRTbGlkZS50cmFuc2xhdGVYID0gKGRpcmVjdGlvbiA9PSAyID8gdGhpcy5zY3JlZW5XaWR0aCA6IC10aGlzLnNjcmVlbldpZHRoKTtcclxuICAgICAgICBuZXh0U2xpZGUub3BhY2l0eSA9IDE7XHJcbiAgICAgICAgdmFyIGRlZmluaXRpb25zID0gbmV3IEFycmF5PEFuaW1hdGlvbkRlZmluaXRpb24+KCk7XHJcbiAgICAgICAgdmFyIGRlZm4xOiBBbmltYXRpb25EZWZpbml0aW9uID0ge1xyXG4gICAgICAgICAgICB0YXJnZXQ6IGN1cnJTbGlkZSxcclxuICAgICAgICAgICAgdHJhbnNsYXRlOiB7IHg6IChkaXJlY3Rpb24gPT0gMiA/IC10aGlzLnNjcmVlbldpZHRoIDogdGhpcy5zY3JlZW5XaWR0aCksIHk6IDAgfSxcclxuICAgICAgICAgICAgZHVyYXRpb246IDUwMFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgZGVmaW5pdGlvbnMucHVzaChkZWZuMSk7XHJcblxyXG4gICAgICAgIHZhciBkZWZuMjogQW5pbWF0aW9uRGVmaW5pdGlvbiA9IHtcclxuICAgICAgICAgICAgdGFyZ2V0OiBuZXh0U2xpZGUsXHJcbiAgICAgICAgICAgIHRyYW5zbGF0ZTogeyB4OiAwLCB5OiAwIH0sXHJcbiAgICAgICAgICAgIGR1cmF0aW9uOiA1MDBcclxuICAgICAgICB9O1xyXG4gICAgICAgIGRlZmluaXRpb25zLnB1c2goZGVmbjIpO1xyXG5cclxuICAgICAgICB2YXIgYW5pbWF0aW9uU2V0ID0gbmV3IEFuaW1hdGlvbihkZWZpbml0aW9ucyk7XHJcbiAgICAgICAgYW5pbWF0aW9uU2V0LnBsYXkoKVxyXG4gICAgICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkFuaW1hdGlvbiBmaW5pc2hlZFwiKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgZ2V0U2xpZGVySXRlbUNsYXNzKGl0ZW06IG51bWJlcikge1xyXG4gICAgICAgIGlmIChpdGVtID09IHRoaXMuY3VycmVudFNsaWRlTnVtKVxyXG4gICAgICAgICAgICByZXR1cm4gXCJjYXJvLWl0ZW0tZG90LXNlbGVjdGVkXCI7XHJcblxyXG4gICAgICAgIHJldHVybiBcImNhcm8taXRlbS1kb3RcIjtcclxuICAgIH1cclxuXHJcbiAgICBnZXRUeXBlUXVlc3Rpb24ocXVlc3QpIHtcclxuICAgICAgICBsZXQgbmJSID0gMDtcclxuICAgICAgICBsZXQgbmJKID0gMDtcclxuXHJcbiAgICAgICAgaWYgKHF1ZXN0LnJlcDEgIT0gbnVsbCkgbmJSICs9IDFcclxuICAgICAgICBpZiAocXVlc3QucmVwMiAhPSBudWxsKSBuYlIgKz0gMVxyXG4gICAgICAgIGlmIChxdWVzdC5yZXAzICE9IG51bGwpIG5iUiArPSAxXHJcbiAgICAgICAgaWYgKHF1ZXN0LnJlcDQgIT0gbnVsbCkgbmJSICs9IDFcclxuICAgICAgICBpZiAocXVlc3QucmVwNSAhPSBudWxsKSBuYlIgKz0gMVxyXG4gICAgICAgIGlmIChxdWVzdC5yZXA2ICE9IG51bGwpIG5iUiArPSAxXHJcblxyXG4gICAgICAgIGlmIChxdWVzdC5qdXN0MSAhPSBcIjBcIikgbmJKICs9IDFcclxuICAgICAgICBpZiAocXVlc3QuanVzdDIgIT0gXCIwXCIpIG5iSiArPSAxXHJcbiAgICAgICAgaWYgKHF1ZXN0Lmp1c3QzICE9IFwiMFwiKSBuYkogKz0gMVxyXG4gICAgICAgIGlmIChxdWVzdC5qdXN0NCAhPSBcIjBcIikgbmJKICs9IDFcclxuICAgICAgICBpZiAocXVlc3QuanVzdDUgIT0gXCIwXCIpIG5iSiArPSAxXHJcbiAgICAgICAgaWYgKHF1ZXN0Lmp1c3Q2ICE9IFwiMFwiKSBuYkogKz0gMVxyXG4gICAgICAgIGlmIChuYlIgPT0gMSAmJiBuYkogPT0gMSkgcmV0dXJuIHsgdHlwZTogXCJ0XCIsIG5Qcm86IG5iUiB9XHJcbiAgICAgICAgZWxzZSBpZiAobmJSID4gMSAmJiBuYkogPT0gMSkgcmV0dXJuIHsgdHlwZTogXCJyXCIsIG5Qcm86IG5iUiB9XHJcbiAgICAgICAgcmV0dXJuIHsgdHlwZTogXCJjXCIsIG5Qcm86IG5iUiB9XHJcbiAgICB9XHJcbiAgICAvLy0tLS0tLVJhZGlvIEJ1dHRvbi0tLS0tLS0tL1xyXG4gICAgY2hhbmdlQ2hlY2tlZFJhZGlvKGlkUSwgdHh0Uikge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGlkUStcIiAgXCIrdHh0UikgXHJcbiAgICAgICAgXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnJhZGlvT3B0aW9ucy5sZW5ndGg7IGkrKylcclxuICAgICAgICAgICAgaWYgKHRoaXMucmFkaW9PcHRpb25zW2ldLmlkUXVlID09IGlkUSAmJiB0aGlzLnJhZGlvT3B0aW9uc1tpXS50eHRSZXAgPT0gdHh0UilcclxuICAgICAgICAgICAgICAgIHRoaXMucmFkaW9PcHRpb25zW2ldLnNlbGVjdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgZWxzZSBpZih0aGlzLnJhZGlvT3B0aW9uc1tpXS5pZFF1ZSA9PSBpZFEgJiYgdGhpcy5yYWRpb09wdGlvbnNbaV0udHh0UmVwICE9IHR4dFIpXHJcbiAgICAgICAgICAgICAgICB0aGlzLnJhZGlvT3B0aW9uc1tpXS5zZWxlY3RlZCA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMucmFkaW9PcHRpb25zKVxyXG4gICAgfVxyXG4gICAgZWxhdFJhZGlvKGlkUSwgdHh0Uik6Ym9vbGVhbiB7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnJhZGlvT3B0aW9ucy5sZW5ndGg7IGkrKylcclxuICAgICAgICAgICAgaWYgKHRoaXMucmFkaW9PcHRpb25zW2ldLmlkUXVlID09IGlkUSAmJiB0aGlzLnJhZGlvT3B0aW9uc1tpXS50eHRSZXAgPT0gdHh0UilcclxuICAgICAgICAgICAgcmV0dXJuICB0aGlzLnJhZGlvT3B0aW9uc1tpXS5zZWxlY3RlZCB8fCBmYWxzZTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbn0iXX0=