"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var router_1 = require("nativescript-angular/router");
var page_1 = require("ui/page");
var animation_1 = require("ui/animation");
var platform_1 = require("platform");
var app = require("application");
var question_slides_service_1 = require("./question-slides.service");
var router_2 = require("@angular/router");
var config_1 = require("../../parameters/config");
var radio_option_1 = require("../../services/radio-option");
var application_settings_1 = require("tns-core-modules/application-settings/application-settings");
var QuestionComponent = /** @class */ (function () {
    function QuestionComponent(page, nav, activatedRoute, questionService) {
        this.page = page;
        this.nav = nav;
        this.activatedRoute = activatedRoute;
        this.questionService = questionService;
        this.pathImage = config_1.Config;
        this.radioOptions = [];
        this.showSlideQuestion = false;
        this.currentSlideNum = 0;
        this.screenWidth = platform_1.screen.mainScreen.widthDIPs;
        // Span the background under status bar on Android
        if (platform_1.isAndroid && platform_1.device.sdkVersion >= '21') {
            var View = android.view.View;
            var window = app.android.startActivity.getWindow();
            window.setStatusBarColor(0x000000);
            var decorView = window.getDecorView();
            decorView.setSystemUiVisibility(View.SYSTEM_UI_FLAG_LAYOUT_STABLE
                | View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION
                | View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN
                | View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY);
        }
    }
    QuestionComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.creeenheight = platform_1.screen.mainScreen.heightDIPs;
        this.dictionayjson = require(config_1.Config.dictionaryUrl);
        this.id_test = this.activatedRoute.snapshot.paramMap.get('id_test');
        this.timeQCM = application_settings_1.getString("test_duree_pre");
        this.timeSecond = 60;
        var gridMain = this.gridMain.nativeElement;
        gridMain.height = 0;
        this.questionService.getListQuestions(this.id_test).subscribe(function (data) {
            _this.listeQuestion = data;
            _this.slideCount = _this.listeQuestion.length;
            _this.listeRepond = _this.listeQuestion;
            //---------RadioButton-----------//
            _this.listeQuestion.forEach(function (item) {
                if (_this.getTypeQuestion(item).type == 'r') {
                    _this.radioOptions
                        .push(new radio_option_1.RadioOption(item.id, item.rep1, false));
                    _this.radioOptions
                        .push(new radio_option_1.RadioOption(item.id, item.rep2, false));
                    _this.radioOptions
                        .push(new radio_option_1.RadioOption(item.id, item.rep3, false));
                    _this.radioOptions
                        .push(new radio_option_1.RadioOption(item.id, item.rep4, false));
                    _this.radioOptions
                        .push(new radio_option_1.RadioOption(item.id, item.rep5, false));
                    _this.radioOptions
                        .push(new radio_option_1.RadioOption(item.id, item.rep6, false));
                }
            });
            //------------------//
            console.log(_this.listeRepond);
            _this.slideView = _this.slideElement.nativeElement;
            var gridViewC = _this.gridViewC.nativeElement;
            _this.slideView.content = (_this.slidesView = gridViewC);
            //Opacity and swipe all
            setTimeout(function () {
                for (var i = 1; i < _this.slideCount; i++) {
                    _this.slidesView.getChildAt(i).opacity = 0;
                }
                _this.listeQuestion.forEach(function (item) {
                    var ii = 0;
                    _this.onSwipe(2, 10);
                    console.log(ii++);
                }, 50);
            });
        }, function (error) {
            console.log("error question");
        });
        //---------------------------//
        this.page.actionBarHidden = true;
        this.page.cssClasses.add("welcome-page-background");
        this.page.backgroundSpanUnderStatusBar = true;
    };
    //-------------------------------//
    QuestionComponent.prototype.onProgressBarLoaded = function (args) {
        var myProgressBar = args.object;
        myProgressBar.value = 10;
        myProgressBar.maxValue = 200;
        setInterval(function () {
            myProgressBar.value += 4;
        }, 100);
    };
    QuestionComponent.prototype.onValueChanged = function (args) {
        var _this = this;
        var myProgressBar = args.object;
        console.log("Old Value: " + args.oldValue);
        console.log("New Value: " + args.value);
        if (args.value == 200) {
            this.showSlideQuestion = true;
            var gridMain = this.gridMain.nativeElement;
            gridMain.height = this.creeenheight;
            //------------time circulation --------//
            var timeM = setInterval(function () {
                _this.timeQCM -= 1;
                _this.timeSecond = 60;
                if (_this.timeQCM == 0) {
                    clearInterval(timeM);
                }
            }, 60000);
            var timeS = setInterval(function () {
                _this.timeSecond -= 1;
                if (_this.timeQCM == 0)
                    clearInterval(timeS);
            }, 1000);
        }
    };
    //-------------------------------//
    QuestionComponent.prototype.onSwipe = function (direction, duree) {
        var prevSlideNum = this.currentSlideNum;
        var count = this.slideCount;
        if (direction == 2) {
            this.currentSlideNum = (this.currentSlideNum + 1) % count;
        }
        else if (direction == 1) {
            this.currentSlideNum = (this.currentSlideNum - 1 + count) % count;
        }
        else {
            // We are interested in left and right directions
            return;
        }
        var currSlide = this.slidesView.getChildAt(prevSlideNum);
        var nextSlide = this.slidesView.getChildAt(this.currentSlideNum);
        console.log(this.currentSlideNum);
        this.animate(currSlide, nextSlide, direction, duree);
    };
    QuestionComponent.prototype.animate = function (currSlide, nextSlide, direction, duree) {
        nextSlide.translateX = (direction == 2 ? this.screenWidth : -this.screenWidth);
        nextSlide.opacity = 1;
        var definitions = new Array();
        var defn1 = {
            target: currSlide,
            translate: { x: (direction == 2 ? -this.screenWidth : this.screenWidth), y: 0 },
            duration: duree
        };
        definitions.push(defn1);
        var defn2 = {
            target: nextSlide,
            translate: { x: 0, y: 0 },
            duration: duree
        };
        definitions.push(defn2);
        var animationSet = new animation_1.Animation(definitions);
        animationSet.play()
            .then(function () {
            console.log("Animation finished");
        })
            .catch(function (e) {
            console.log(e.message);
        });
    };
    QuestionComponent.prototype.getSliderItemClass = function (item) {
        if (item == this.currentSlideNum)
            return "caro-item-dot-selected";
        return "caro-item-dot";
    };
    QuestionComponent.prototype.getTypeQuestion = function (quest) {
        var nbR = 0;
        var nbJ = 0;
        if (quest.rep1 != null)
            nbR += 1;
        if (quest.rep2 != null)
            nbR += 1;
        if (quest.rep3 != null)
            nbR += 1;
        if (quest.rep4 != null)
            nbR += 1;
        if (quest.rep5 != null)
            nbR += 1;
        if (quest.rep6 != null)
            nbR += 1;
        if (quest.just1 != "0")
            nbJ += 1;
        if (quest.just2 != "0")
            nbJ += 1;
        if (quest.just3 != "0")
            nbJ += 1;
        if (quest.just4 != "0")
            nbJ += 1;
        if (quest.just5 != "0")
            nbJ += 1;
        if (quest.just6 != "0")
            nbJ += 1;
        if (nbR == 1 && nbJ == 1)
            return { type: "t", nPro: nbR };
        else if (nbR > 1 && nbJ == 1)
            return { type: "r", nPro: nbR };
        return { type: "c", nPro: nbR };
    };
    //------Radio Button--------/
    QuestionComponent.prototype.changeCheckedRadio = function (idQ, txtR) {
        console.log(idQ + "  " + txtR);
        for (var i = 0; i < this.radioOptions.length; i++)
            if (this.radioOptions[i].idQue == idQ && this.radioOptions[i].txtRep == txtR)
                this.radioOptions[i].selected = true;
            else if (this.radioOptions[i].idQue == idQ && this.radioOptions[i].txtRep != txtR)
                this.radioOptions[i].selected = false;
        console.log(this.radioOptions);
    };
    QuestionComponent.prototype.elatRadio = function (idQ, txtR) {
        for (var i = 0; i < this.radioOptions.length; i++)
            if (this.radioOptions[i].idQue == idQ && this.radioOptions[i].txtRep == txtR)
                return this.radioOptions[i].selected || false;
        return false;
    };
    QuestionComponent.prototype.onCheckBoxTap = function () {
        console.log("aaaaaa");
    };
    __decorate([
        core_1.ViewChild('slideContent'),
        __metadata("design:type", core_1.ElementRef)
    ], QuestionComponent.prototype, "slideElement", void 0);
    __decorate([
        core_1.ViewChild('gridViewC'),
        __metadata("design:type", core_1.ElementRef)
    ], QuestionComponent.prototype, "gridViewC", void 0);
    __decorate([
        core_1.ViewChild('gridMain'),
        __metadata("design:type", core_1.ElementRef)
    ], QuestionComponent.prototype, "gridMain", void 0);
    QuestionComponent = __decorate([
        core_1.Component({
            selector: "question",
            moduleId: module.id,
            templateUrl: "./question.component.html",
            styleUrls: ["./question.component.css"]
        }),
        __metadata("design:paramtypes", [page_1.Page,
            router_1.RouterExtensions,
            router_2.ActivatedRoute,
            question_slides_service_1.QuestionSlidesService])
    ], QuestionComponent);
    return QuestionComponent;
}());
exports.QuestionComponent = QuestionComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVlc3Rpb24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicXVlc3Rpb24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQWdGO0FBQ2hGLHNEQUErRDtBQUUvRCxnQ0FBa0Q7QUFHbEQsMENBQThEO0FBQzlELHFDQUFxRDtBQUdyRCxpQ0FBbUM7QUFJbkMscUVBQWtFO0FBQ2xFLDBDQUFpRDtBQUdqRCxrREFBaUQ7QUFHakQsNERBQTBEO0FBRzFELG1HQUF1RjtBQVV2RjtJQXdCSSwyQkFDWSxJQUFVLEVBQ1YsR0FBcUIsRUFDckIsY0FBOEIsRUFDOUIsZUFBc0M7UUFIdEMsU0FBSSxHQUFKLElBQUksQ0FBTTtRQUNWLFFBQUcsR0FBSCxHQUFHLENBQWtCO1FBQ3JCLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUM5QixvQkFBZSxHQUFmLGVBQWUsQ0FBdUI7UUF4QmxELGNBQVMsR0FBRyxlQUFNLENBQUM7UUFHbkIsaUJBQVksR0FBRyxFQUFFLENBQUM7UUFDbEIsc0JBQWlCLEdBQUcsS0FBSyxDQUFDO1FBSW5CLG9CQUFlLEdBQVcsQ0FBQyxDQUFDO1FBa0IvQixJQUFJLENBQUMsV0FBVyxHQUFHLGlCQUFNLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQztRQUUvQyxrREFBa0Q7UUFDbEQsSUFBSSxvQkFBUyxJQUFJLGlCQUFNLENBQUMsVUFBVSxJQUFJLElBQUksRUFBRTtZQUN4QyxJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztZQUM3QixJQUFJLE1BQU0sR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUNuRCxNQUFNLENBQUMsaUJBQWlCLENBQUMsUUFBUSxDQUFDLENBQUM7WUFFbkMsSUFBSSxTQUFTLEdBQUcsTUFBTSxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQ3RDLFNBQVMsQ0FBQyxxQkFBcUIsQ0FDM0IsSUFB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Q0FBQyxJQUFJLElBQUksSUFBSTtZQUFFLEdBQUcsSUFBSSxDQUFDLENBQUE7UUFDaEMsSUFBSSxLQUFLLENBQUMsSUFBSSxJQUFJLElBQUk7WUFBRSxHQUFHLElBQUksQ0FBQyxDQUFBO1FBQ2hDLElBQUksS0FBSyxDQUFDLElBQUksSUFBSSxJQUFJO1lBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQTtRQUNoQyxJQUFJLEtBQUssQ0FBQyxJQUFJLElBQUksSUFBSTtZQUFFLEdBQUcsSUFBSSxDQUFDLENBQUE7UUFDaEMsSUFBSSxLQUFLLENBQUMsSUFBSSxJQUFJLElBQUk7WUFBRSxHQUFHLElBQUksQ0FBQyxDQUFBO1FBQ2hDLElBQUksS0FBSyxDQUFDLElBQUksSUFBSSxJQUFJO1lBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQTtRQUVoQyxJQUFJLEtBQUssQ0FBQyxLQUFLLElBQUksR0FBRztZQUFFLEdBQUcsSUFBSSxDQUFDLENBQUE7UUFDaEMsSUFBSSxLQUFLLENBQUMsS0FBSyxJQUFJLEdBQUc7WUFBRSxHQUFHLElBQUksQ0FBQyxDQUFBO1FBQ2hDLElBQUksS0FBSyxDQUFDLEtBQUssSUFBSSxHQUFHO1lBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQTtRQUNoQyxJQUFJLEtBQUssQ0FBQyxLQUFLLElBQUksR0FBRztZQUFFLEdBQUcsSUFBSSxDQUFDLENBQUE7UUFDaEMsSUFBSSxLQUFLLENBQUMsS0FBSyxJQUFJLEdBQUc7WUFBRSxHQUFHLElBQUksQ0FBQyxDQUFBO1FBQ2hDLElBQUksS0FBSyxDQUFDLEtBQUssSUFBSSxHQUFHO1lBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQTtRQUNoQyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7WUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUE7YUFDcEQsSUFBSSxHQUFHLEdBQUcsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1lBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxDQUFBO1FBQzdELE9BQU8sRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsQ0FBQTtJQUNuQyxDQUFDO0lBQ0QsNkJBQTZCO0lBQzdCLDhDQUFrQixHQUFsQixVQUFtQixHQUFHLEVBQUUsSUFBSTtRQUN4QixPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFDLENBQUE7UUFFOUIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRTtZQUM3QyxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxJQUFJLEdBQUcsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sSUFBSSxJQUFJO2dCQUN4RSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7aUJBQ3BDLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksR0FBRyxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxJQUFJLElBQUk7Z0JBQzdFLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQztRQUU5QyxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQTtJQUNsQyxDQUFDO0lBQ0QscUNBQVMsR0FBVCxVQUFVLEdBQUcsRUFBRSxJQUFJO1FBQ2YsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRTtZQUM3QyxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxJQUFJLEdBQUcsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sSUFBSSxJQUFJO2dCQUN4RSxPQUFPLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxJQUFJLEtBQUssQ0FBQztRQUN0RCxPQUFPLEtBQUssQ0FBQztJQUNqQixDQUFDO0lBRUQseUNBQWEsR0FBYjtRQUNJLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUE7SUFDekIsQ0FBQztJQXBPMEI7UUFBMUIsZ0JBQVMsQ0FBQyxjQUFjLENBQUM7a0NBQWUsaUJBQVU7MkRBQUM7SUFDNUI7UUFBdkIsZ0JBQVMsQ0FBQyxXQUFXLENBQUM7a0NBQVksaUJBQVU7d0RBQUM7SUFDdkI7UUFBdEIsZ0JBQVMsQ0FBQyxVQUFVLENBQUM7a0NBQVcsaUJBQVU7dURBQUM7SUFyQm5DLGlCQUFpQjtRQU43QixnQkFBUyxDQUFDO1lBQ1AsUUFBUSxFQUFFLFVBQVU7WUFDcEIsUUFBUSxFQUFFLE1BQU0sQ0FBQyxFQUFFO1lBQ25CLFdBQVcsRUFBRSwyQkFBMkI7WUFDeEMsU0FBUyxFQUFFLENBQUMsMEJBQTBCLENBQUM7U0FDMUMsQ0FBQzt5Q0EwQm9CLFdBQUk7WUFDTCx5QkFBZ0I7WUFDTCx1QkFBYztZQUNiLCtDQUFxQjtPQTVCekMsaUJBQWlCLENBd1A3QjtJQUFELHdCQUFDO0NBQUEsQUF4UEQsSUF3UEM7QUF4UFksOENBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIFZpZXdDaGlsZCwgRWxlbWVudFJlZiwgSW5wdXQgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xyXG5pbXBvcnQgeyBSb3V0ZXJFeHRlbnNpb25zIH0gZnJvbSBcIm5hdGl2ZXNjcmlwdC1hbmd1bGFyL3JvdXRlclwiO1xyXG5cclxuaW1wb3J0IHsgUGFnZSwgQ29udGVudFZpZXcsIFZpZXcgfSBmcm9tIFwidWkvcGFnZVwiO1xyXG5pbXBvcnQgeyBTd2lwZUdlc3R1cmVFdmVudERhdGEgfSBmcm9tIFwidWkvZ2VzdHVyZXMvZ2VzdHVyZXNcIjtcclxuaW1wb3J0IHsgR3JpZExheW91dCwgR3JpZFVuaXRUeXBlLCBJdGVtU3BlYyB9IGZyb20gXCJ1aS9sYXlvdXRzL2dyaWQtbGF5b3V0XCI7XHJcbmltcG9ydCB7IEFuaW1hdGlvbkRlZmluaXRpb24sIEFuaW1hdGlvbiB9IGZyb20gJ3VpL2FuaW1hdGlvbic7XHJcbmltcG9ydCB7IHNjcmVlbiwgaXNBbmRyb2lkLCBkZXZpY2UgfSBmcm9tIFwicGxhdGZvcm1cIjtcclxuXHJcblxyXG5pbXBvcnQgKiBhcyBhcHAgZnJvbSBcImFwcGxpY2F0aW9uXCI7XHJcbmltcG9ydCAqIGFzIGZzIGZyb20gXCJmaWxlLXN5c3RlbVwiO1xyXG5pbXBvcnQgKiBhcyBidWlsZGVyIGZyb20gXCJ1aS9idWlsZGVyXCI7XHJcblxyXG5pbXBvcnQgeyBRdWVzdGlvblNsaWRlc1NlcnZpY2UgfSBmcm9tIFwiLi9xdWVzdGlvbi1zbGlkZXMuc2VydmljZVwiO1xyXG5pbXBvcnQgeyBBY3RpdmF0ZWRSb3V0ZSB9IGZyb20gXCJAYW5ndWxhci9yb3V0ZXJcIjtcclxuaW1wb3J0IHsgU3RhY2tMYXlvdXQgfSBmcm9tIFwidG5zLWNvcmUtbW9kdWxlcy91aS9sYXlvdXRzL3N0YWNrLWxheW91dC9zdGFjay1sYXlvdXRcIjtcclxuaW1wb3J0IHsgUXVlc3Rpb24gfSBmcm9tIFwiLi4vLi4vc2VydmljZXMvcXVlc3Rpb25cIjtcclxuaW1wb3J0IHsgQ29uZmlnIH0gZnJvbSBcIi4uLy4uL3BhcmFtZXRlcnMvY29uZmlnXCI7XHJcblxyXG5cclxuaW1wb3J0IHsgUmFkaW9PcHRpb24gfSBmcm9tIFwiLi4vLi4vc2VydmljZXMvcmFkaW8tb3B0aW9uXCI7XHJcblxyXG5pbXBvcnQgeyBQcm9ncmVzcyB9IGZyb20gXCJ0bnMtY29yZS1tb2R1bGVzL3VpL3Byb2dyZXNzXCI7XHJcbmltcG9ydCB7IGdldFN0cmluZyB9IGZyb20gXCJ0bnMtY29yZS1tb2R1bGVzL2FwcGxpY2F0aW9uLXNldHRpbmdzL2FwcGxpY2F0aW9uLXNldHRpbmdzXCI7XHJcblxyXG5kZWNsYXJlIHZhciBhbmRyb2lkOiBhbnk7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiBcInF1ZXN0aW9uXCIsXHJcbiAgICBtb2R1bGVJZDogbW9kdWxlLmlkLFxyXG4gICAgdGVtcGxhdGVVcmw6IFwiLi9xdWVzdGlvbi5jb21wb25lbnQuaHRtbFwiLFxyXG4gICAgc3R5bGVVcmxzOiBbXCIuL3F1ZXN0aW9uLmNvbXBvbmVudC5jc3NcIl1cclxufSlcclxuZXhwb3J0IGNsYXNzIFF1ZXN0aW9uQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICAgIC8vLS0tLS0tLS0tLS0tLS0vL1xyXG4gICAgbGlzdGVRdWVzdGlvbjogUXVlc3Rpb25bXTtcclxuICAgIGxpc3RlUmVwb25kOlF1ZXN0aW9uW107XHJcbiAgICBwYXRoSW1hZ2UgPSBDb25maWc7XHJcbiAgICB0aW1lUUNNO1xyXG4gICAgdGltZVNlY29uZDtcclxuICAgIHJhZGlvT3B0aW9ucyA9IFtdO1xyXG4gICAgc2hvd1NsaWRlUXVlc3Rpb24gPSBmYWxzZTtcclxuICAgIGRpY3Rpb25heWpzb247XHJcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS8vXHJcbiAgICBwdWJsaWMgaWRfdGVzdDtcclxuICAgIHB1YmxpYyBjdXJyZW50U2xpZGVOdW06IG51bWJlciA9IDA7XHJcbiAgICBwcml2YXRlIHNsaWRlQ291bnQ6IG51bWJlcjtcclxuXHJcbiAgICBwcml2YXRlIHNjcmVlbldpZHRoO1xyXG4gICAgcHJpdmF0ZSBzbGlkZXNWaWV3OiBHcmlkTGF5b3V0O1xyXG4gICAgcHJpdmF0ZSBjcmVlZW5oZWlnaHQ7XHJcblxyXG4gICAgQFZpZXdDaGlsZCgnc2xpZGVDb250ZW50Jykgc2xpZGVFbGVtZW50OiBFbGVtZW50UmVmO1xyXG4gICAgQFZpZXdDaGlsZCgnZ3JpZFZpZXdDJykgZ3JpZFZpZXdDOiBFbGVtZW50UmVmO1xyXG4gICAgQFZpZXdDaGlsZCgnZ3JpZE1haW4nKSBncmlkTWFpbjogRWxlbWVudFJlZjtcclxuICAgIHByaXZhdGUgc2xpZGVWaWV3OiBDb250ZW50VmlldztcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIHBhZ2U6IFBhZ2UsXHJcbiAgICAgICAgcHJpdmF0ZSBuYXY6IFJvdXRlckV4dGVuc2lvbnMsXHJcbiAgICAgICAgcHJpdmF0ZSBhY3RpdmF0ZWRSb3V0ZTogQWN0aXZhdGVkUm91dGUsXHJcbiAgICAgICAgcHJpdmF0ZSBxdWVzdGlvblNlcnZpY2U6IFF1ZXN0aW9uU2xpZGVzU2VydmljZVxyXG4gICAgKSB7XHJcbiAgICAgICAgdGhpcy5zY3JlZW5XaWR0aCA9IHNjcmVlbi5tYWluU2NyZWVuLndpZHRoRElQcztcclxuXHJcbiAgICAgICAgLy8gU3BhbiB0aGUgYmFja2dyb3VuZCB1bmRlciBzdGF0dXMgYmFyIG9uIEFuZHJvaWRcclxuICAgICAgICBpZiAoaXNBbmRyb2lkICYmIGRldmljZS5zZGtWZXJzaW9uID49ICcyMScpIHtcclxuICAgICAgICAgICAgdmFyIFZpZXcgPSBhbmRyb2lkLnZpZXcuVmlldztcclxuICAgICAgICAgICAgdmFyIHdpbmRvdyA9IGFwcC5hbmRyb2lkLnN0YXJ0QWN0aXZpdHkuZ2V0V2luZG93KCk7XHJcbiAgICAgICAgICAgIHdpbmRvdy5zZXRTdGF0dXNCYXJDb2xvcigweDAwMDAwMCk7XHJcbiAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciBkZWNvclZpZXcgPSB3aW5kb3cuZ2V0RGVjb3JWaWV3KCk7XHJcbiAgICAgICAgICAgIGRlY29yVmlldy5zZXRTeXN0ZW1VaVZpc2liaWxpdHkoXHJcbiAgICAgICAgICAgICAgICBWaWV3LlNZU1RFTV9VSV9GTEFHX0xBWU9VVF9TVEFCTEVcclxuICAgICAgICAgICAgICAgIHwgVmlldy5TWVNURU1fVUlfRkxBR19MQVlPVVRfSElERV9OQVZJR0FUSU9OXHJcbiAgICAgICAgICAgICAgICB8IFZpZXcuU1lTVEVNX1VJX0ZMQUdfTEFZT1VUX0ZVTExTQ1JFRU5cclxuICAgICAgICAgICAgICAgIHwgVmlldy5TWVNURU1fVUlfRkxBR19JTU1FUlNJVkVfU1RJQ0tZKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgdGhpcy5jcmVlZW5oZWlnaHQgPSBzY3JlZW4ubWFpblNjcmVlbi5oZWlnaHRESVBzO1xyXG4gICAgICAgIHRoaXMuZGljdGlvbmF5anNvbiA9IHJlcXVpcmUoQ29uZmlnLmRpY3Rpb25hcnlVcmwpO1xyXG4gICAgICAgIHRoaXMuaWRfdGVzdCA9IHRoaXMuYWN0aXZhdGVkUm91dGUuc25hcHNob3QucGFyYW1NYXAuZ2V0KCdpZF90ZXN0Jyk7XHJcbiAgICAgICAgdGhpcy50aW1lUUNNID0gZ2V0U3RyaW5nKFwidGVzdF9kdXJlZV9wcmVcIik7XHJcbiAgICAgICAgdGhpcy50aW1lU2Vjb25kID0gNjA7XHJcbiAgICAgICAgbGV0IGdyaWRNYWluOiBHcmlkTGF5b3V0ID0gdGhpcy5ncmlkTWFpbi5uYXRpdmVFbGVtZW50IGFzIEdyaWRMYXlvdXQ7XHJcbiAgICAgICAgZ3JpZE1haW4uaGVpZ2h0ID0gMFxyXG5cclxuICAgICAgICB0aGlzLnF1ZXN0aW9uU2VydmljZS5nZXRMaXN0UXVlc3Rpb25zKHRoaXMuaWRfdGVzdCkuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICBkYXRhID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMubGlzdGVRdWVzdGlvbiA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNsaWRlQ291bnQgPSB0aGlzLmxpc3RlUXVlc3Rpb24ubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5saXN0ZVJlcG9uZCA9IHRoaXMubGlzdGVRdWVzdGlvbjtcclxuICAgICAgICAgICAgICAgIC8vLS0tLS0tLS0tUmFkaW9CdXR0b24tLS0tLS0tLS0tLS8vXHJcbiAgICAgICAgICAgICAgICB0aGlzLmxpc3RlUXVlc3Rpb24uZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5nZXRUeXBlUXVlc3Rpb24oaXRlbSkudHlwZSA9PSAncicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yYWRpb09wdGlvbnNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5wdXNoKG5ldyBSYWRpb09wdGlvbihpdGVtLmlkLCBpdGVtLnJlcDEsIGZhbHNlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmFkaW9PcHRpb25zXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucHVzaChuZXcgUmFkaW9PcHRpb24oaXRlbS5pZCwgaXRlbS5yZXAyLCBmYWxzZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJhZGlvT3B0aW9uc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnB1c2gobmV3IFJhZGlvT3B0aW9uKGl0ZW0uaWQsIGl0ZW0ucmVwMywgZmFsc2UpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yYWRpb09wdGlvbnNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5wdXNoKG5ldyBSYWRpb09wdGlvbihpdGVtLmlkLCBpdGVtLnJlcDQsIGZhbHNlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmFkaW9PcHRpb25zXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucHVzaChuZXcgUmFkaW9PcHRpb24oaXRlbS5pZCwgaXRlbS5yZXA1LCBmYWxzZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJhZGlvT3B0aW9uc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnB1c2gobmV3IFJhZGlvT3B0aW9uKGl0ZW0uaWQsIGl0ZW0ucmVwNiwgZmFsc2UpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS8vXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmxpc3RlUmVwb25kKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5zbGlkZVZpZXcgPSB0aGlzLnNsaWRlRWxlbWVudC5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgICAgICAgICAgbGV0IGdyaWRWaWV3QzogR3JpZExheW91dCA9IHRoaXMuZ3JpZFZpZXdDLm5hdGl2ZUVsZW1lbnQgYXMgR3JpZExheW91dDtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2xpZGVWaWV3LmNvbnRlbnQgPSAodGhpcy5zbGlkZXNWaWV3ID0gZ3JpZFZpZXdDKTtcclxuICAgICAgICAgICAgICAgIC8vT3BhY2l0eSBhbmQgc3dpcGUgYWxsXHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHRoaXMuc2xpZGVDb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2xpZGVzVmlldy5nZXRDaGlsZEF0KGkpLm9wYWNpdHkgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxpc3RlUXVlc3Rpb24uZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGlpID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vblN3aXBlKDIsIDEwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhpaSsrKVxyXG4gICAgICAgICAgICAgICAgICAgIH0sIDUwKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3IgcXVlc3Rpb25cIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICApO1xyXG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLy9cclxuICAgICAgICB0aGlzLnBhZ2UuYWN0aW9uQmFySGlkZGVuID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnBhZ2UuY3NzQ2xhc3Nlcy5hZGQoXCJ3ZWxjb21lLXBhZ2UtYmFja2dyb3VuZFwiKTtcclxuICAgICAgICB0aGlzLnBhZ2UuYmFja2dyb3VuZFNwYW5VbmRlclN0YXR1c0JhciA9IHRydWU7XHJcblxyXG5cclxuICAgIH1cclxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS8vXHJcblxyXG4gICAgb25Qcm9ncmVzc0JhckxvYWRlZChhcmdzKSB7XHJcbiAgICAgICAgbGV0IG15UHJvZ3Jlc3NCYXIgPSA8UHJvZ3Jlc3M+YXJncy5vYmplY3Q7XHJcblxyXG4gICAgICAgIG15UHJvZ3Jlc3NCYXIudmFsdWUgPSAxMDtcclxuICAgICAgICBteVByb2dyZXNzQmFyLm1heFZhbHVlID0gMjAwO1xyXG5cclxuICAgICAgICBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIG15UHJvZ3Jlc3NCYXIudmFsdWUgKz0gNDtcclxuICAgICAgICB9LCAxMDApO1xyXG4gICAgfVxyXG5cclxuICAgIG9uVmFsdWVDaGFuZ2VkKGFyZ3MpIHtcclxuICAgICAgICBsZXQgbXlQcm9ncmVzc0JhciA9IDxQcm9ncmVzcz5hcmdzLm9iamVjdDtcclxuXHJcbiAgICAgICAgY29uc29sZS5sb2coXCJPbGQgVmFsdWU6IFwiICsgYXJncy5vbGRWYWx1ZSk7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJOZXcgVmFsdWU6IFwiICsgYXJncy52YWx1ZSk7XHJcbiAgICAgICAgaWYgKGFyZ3MudmFsdWUgPT0gMjAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvd1NsaWRlUXVlc3Rpb24gPSB0cnVlO1xyXG4gICAgICAgICAgICBsZXQgZ3JpZE1haW46IEdyaWRMYXlvdXQgPSB0aGlzLmdyaWRNYWluLm5hdGl2ZUVsZW1lbnQgYXMgR3JpZExheW91dDtcclxuICAgICAgICAgICAgZ3JpZE1haW4uaGVpZ2h0ID0gdGhpcy5jcmVlZW5oZWlnaHQ7XHJcbiAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tdGltZSBjaXJjdWxhdGlvbiAtLS0tLS0tLS8vXHJcbiAgICAgICAgICAgIHZhciB0aW1lTSA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGltZVFDTSAtPSAxO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50aW1lU2Vjb25kID0gNjA7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy50aW1lUUNNID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHRpbWVNKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH0sIDYwMDAwKTtcclxuXHJcbiAgICAgICAgICAgIHZhciB0aW1lUyA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGltZVNlY29uZCAtPSAxO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudGltZVFDTSA9PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGltZVMpO1xyXG4gICAgICAgICAgICB9LCAxMDAwKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLy9cclxuICAgIG9uU3dpcGUoZGlyZWN0aW9uOiBudW1iZXIsIGR1cmVlOiBudW1iZXIpIHtcclxuXHJcbiAgICAgICAgbGV0IHByZXZTbGlkZU51bSA9IHRoaXMuY3VycmVudFNsaWRlTnVtO1xyXG4gICAgICAgIGxldCBjb3VudCA9IHRoaXMuc2xpZGVDb3VudDtcclxuXHJcbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PSAyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFNsaWRlTnVtID0gKHRoaXMuY3VycmVudFNsaWRlTnVtICsgMSkgJSBjb3VudDtcclxuICAgICAgICB9IGVsc2UgaWYgKGRpcmVjdGlvbiA9PSAxKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFNsaWRlTnVtID0gKHRoaXMuY3VycmVudFNsaWRlTnVtIC0gMSArIGNvdW50KSAlIGNvdW50O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIFdlIGFyZSBpbnRlcmVzdGVkIGluIGxlZnQgYW5kIHJpZ2h0IGRpcmVjdGlvbnNcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgY3VyclNsaWRlID0gdGhpcy5zbGlkZXNWaWV3LmdldENoaWxkQXQocHJldlNsaWRlTnVtKTtcclxuICAgICAgICBjb25zdCBuZXh0U2xpZGUgPSB0aGlzLnNsaWRlc1ZpZXcuZ2V0Q2hpbGRBdCh0aGlzLmN1cnJlbnRTbGlkZU51bSk7XHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuY3VycmVudFNsaWRlTnVtKTtcclxuICAgICAgICB0aGlzLmFuaW1hdGUoY3VyclNsaWRlLCBuZXh0U2xpZGUsIGRpcmVjdGlvbiwgZHVyZWUpO1xyXG4gICAgfVxyXG5cclxuICAgIGFuaW1hdGUoY3VyclNsaWRlLCBuZXh0U2xpZGUsIGRpcmVjdGlvbiwgZHVyZWUpIHtcclxuICAgICAgICBuZXh0U2xpZGUudHJhbnNsYXRlWCA9IChkaXJlY3Rpb24gPT0gMiA/IHRoaXMuc2NyZWVuV2lkdGggOiAtdGhpcy5zY3JlZW5XaWR0aCk7XHJcbiAgICAgICAgbmV4dFNsaWRlLm9wYWNpdHkgPSAxO1xyXG4gICAgICAgIHZhciBkZWZpbml0aW9ucyA9IG5ldyBBcnJheTxBbmltYXRpb25EZWZpbml0aW9uPigpO1xyXG4gICAgICAgIHZhciBkZWZuMTogQW5pbWF0aW9uRGVmaW5pdGlvbiA9IHtcclxuICAgICAgICAgICAgdGFyZ2V0OiBjdXJyU2xpZGUsXHJcbiAgICAgICAgICAgIHRyYW5zbGF0ZTogeyB4OiAoZGlyZWN0aW9uID09IDIgPyAtdGhpcy5zY3JlZW5XaWR0aCA6IHRoaXMuc2NyZWVuV2lkdGgpLCB5OiAwIH0sXHJcbiAgICAgICAgICAgIGR1cmF0aW9uOiBkdXJlZVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgZGVmaW5pdGlvbnMucHVzaChkZWZuMSk7XHJcblxyXG4gICAgICAgIHZhciBkZWZuMjogQW5pbWF0aW9uRGVmaW5pdGlvbiA9IHtcclxuICAgICAgICAgICAgdGFyZ2V0OiBuZXh0U2xpZGUsXHJcbiAgICAgICAgICAgIHRyYW5zbGF0ZTogeyB4OiAwLCB5OiAwIH0sXHJcbiAgICAgICAgICAgIGR1cmF0aW9uOiBkdXJlZVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgZGVmaW5pdGlvbnMucHVzaChkZWZuMik7XHJcblxyXG4gICAgICAgIHZhciBhbmltYXRpb25TZXQgPSBuZXcgQW5pbWF0aW9uKGRlZmluaXRpb25zKTtcclxuICAgICAgICBhbmltYXRpb25TZXQucGxheSgpXHJcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQW5pbWF0aW9uIGZpbmlzaGVkXCIpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuY2F0Y2goKGUpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGUubWVzc2FnZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBnZXRTbGlkZXJJdGVtQ2xhc3MoaXRlbTogbnVtYmVyKSB7XHJcbiAgICAgICAgaWYgKGl0ZW0gPT0gdGhpcy5jdXJyZW50U2xpZGVOdW0pXHJcbiAgICAgICAgICAgIHJldHVybiBcImNhcm8taXRlbS1kb3Qtc2VsZWN0ZWRcIjtcclxuXHJcbiAgICAgICAgcmV0dXJuIFwiY2Fyby1pdGVtLWRvdFwiO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFR5cGVRdWVzdGlvbihxdWVzdCkge1xyXG4gICAgICAgIGxldCBuYlIgPSAwO1xyXG4gICAgICAgIGxldCBuYkogPSAwO1xyXG5cclxuICAgICAgICBpZiAocXVlc3QucmVwMSAhPSBudWxsKSBuYlIgKz0gMVxyXG4gICAgICAgIGlmIChxdWVzdC5yZXAyICE9IG51bGwpIG5iUiArPSAxXHJcbiAgICAgICAgaWYgKHF1ZXN0LnJlcDMgIT0gbnVsbCkgbmJSICs9IDFcclxuICAgICAgICBpZiAocXVlc3QucmVwNCAhPSBudWxsKSBuYlIgKz0gMVxyXG4gICAgICAgIGlmIChxdWVzdC5yZXA1ICE9IG51bGwpIG5iUiArPSAxXHJcbiAgICAgICAgaWYgKHF1ZXN0LnJlcDYgIT0gbnVsbCkgbmJSICs9IDFcclxuXHJcbiAgICAgICAgaWYgKHF1ZXN0Lmp1c3QxICE9IFwiMFwiKSBuYkogKz0gMVxyXG4gICAgICAgIGlmIChxdWVzdC5qdXN0MiAhPSBcIjBcIikgbmJKICs9IDFcclxuICAgICAgICBpZiAocXVlc3QuanVzdDMgIT0gXCIwXCIpIG5iSiArPSAxXHJcbiAgICAgICAgaWYgKHF1ZXN0Lmp1c3Q0ICE9IFwiMFwiKSBuYkogKz0gMVxyXG4gICAgICAgIGlmIChxdWVzdC5qdXN0NSAhPSBcIjBcIikgbmJKICs9IDFcclxuICAgICAgICBpZiAocXVlc3QuanVzdDYgIT0gXCIwXCIpIG5iSiArPSAxXHJcbiAgICAgICAgaWYgKG5iUiA9PSAxICYmIG5iSiA9PSAxKSByZXR1cm4geyB0eXBlOiBcInRcIiwgblBybzogbmJSIH1cclxuICAgICAgICBlbHNlIGlmIChuYlIgPiAxICYmIG5iSiA9PSAxKSByZXR1cm4geyB0eXBlOiBcInJcIiwgblBybzogbmJSIH1cclxuICAgICAgICByZXR1cm4geyB0eXBlOiBcImNcIiwgblBybzogbmJSIH1cclxuICAgIH1cclxuICAgIC8vLS0tLS0tUmFkaW8gQnV0dG9uLS0tLS0tLS0vXHJcbiAgICBjaGFuZ2VDaGVja2VkUmFkaW8oaWRRLCB0eHRSKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coaWRRICsgXCIgIFwiICsgdHh0UilcclxuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnJhZGlvT3B0aW9ucy5sZW5ndGg7IGkrKylcclxuICAgICAgICAgICAgaWYgKHRoaXMucmFkaW9PcHRpb25zW2ldLmlkUXVlID09IGlkUSAmJiB0aGlzLnJhZGlvT3B0aW9uc1tpXS50eHRSZXAgPT0gdHh0UilcclxuICAgICAgICAgICAgICAgIHRoaXMucmFkaW9PcHRpb25zW2ldLnNlbGVjdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5yYWRpb09wdGlvbnNbaV0uaWRRdWUgPT0gaWRRICYmIHRoaXMucmFkaW9PcHRpb25zW2ldLnR4dFJlcCAhPSB0eHRSKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5yYWRpb09wdGlvbnNbaV0uc2VsZWN0ZWQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5yYWRpb09wdGlvbnMpXHJcbiAgICB9XHJcbiAgICBlbGF0UmFkaW8oaWRRLCB0eHRSKTogYm9vbGVhbiB7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnJhZGlvT3B0aW9ucy5sZW5ndGg7IGkrKylcclxuICAgICAgICAgICAgaWYgKHRoaXMucmFkaW9PcHRpb25zW2ldLmlkUXVlID09IGlkUSAmJiB0aGlzLnJhZGlvT3B0aW9uc1tpXS50eHRSZXAgPT0gdHh0UilcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJhZGlvT3B0aW9uc1tpXS5zZWxlY3RlZCB8fCBmYWxzZTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgb25DaGVja0JveFRhcCgpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcImFhYWFhYVwiKVxyXG4gICAgfVxyXG59Il19