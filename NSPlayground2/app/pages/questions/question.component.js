"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var router_1 = require("nativescript-angular/router");
var page_1 = require("ui/page");
var animation_1 = require("ui/animation");
var platform_1 = require("platform");
var app = require("application");
var question_slides_service_1 = require("./question-slides.service");
var router_2 = require("@angular/router");
var config_1 = require("../../parameters/config");
var radio_option_1 = require("../../services/radio-option");
var application_settings_1 = require("tns-core-modules/application-settings/application-settings");
var QuestionComponent = /** @class */ (function () {
    function QuestionComponent(page, nav, activatedRoute, questionService) {
        this.page = page;
        this.nav = nav;
        this.activatedRoute = activatedRoute;
        this.questionService = questionService;
        this.pathImage = config_1.Config;
        this.radioOptions = [];
        this.showSlideQuestion = false;
        this.currentSlideNum = 0;
        this.screenWidth = platform_1.screen.mainScreen.widthDIPs;
        // Span the background under status bar on Android
        if (platform_1.isAndroid && platform_1.device.sdkVersion >= '21') {
            var View = android.view.View;
            var window = app.android.startActivity.getWindow();
            window.setStatusBarColor(0x000000);
            var decorView = window.getDecorView();
            decorView.setSystemUiVisibility(View.SYSTEM_UI_FLAG_LAYOUT_STABLE
                | View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION
                | View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN
                | View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY);
        }
    }
    QuestionComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.dictionayjson = require(config_1.Config.dictionaryUrl);
        this.id_test = this.activatedRoute.snapshot.paramMap.get('id_test');
        this.timeQCM = application_settings_1.getString("test_duree_pre");
        this.timeSecond = 60;
        var gridMain = this.gridMain.nativeElement;
        gridMain.height = 0;
        this.questionService.getListQuestions(this.id_test).subscribe(function (data) {
            _this.listeQuestion = data;
            _this.slideCount = _this.listeQuestion.length;
            //---------RadioButton-----------//
            _this.listeQuestion.forEach(function (item) {
                if (_this.getTypeQuestion(item).type == 'r') {
                    _this.radioOptions
                        .push(new radio_option_1.RadioOption(item.id, item.rep1, false));
                    _this.radioOptions
                        .push(new radio_option_1.RadioOption(item.id, item.rep2, false));
                    _this.radioOptions
                        .push(new radio_option_1.RadioOption(item.id, item.rep3, false));
                    _this.radioOptions
                        .push(new radio_option_1.RadioOption(item.id, item.rep4, false));
                    _this.radioOptions
                        .push(new radio_option_1.RadioOption(item.id, item.rep5, false));
                    _this.radioOptions
                        .push(new radio_option_1.RadioOption(item.id, item.rep6, false));
                }
            });
            //------------------//
            _this.slideView = _this.slideElement.nativeElement;
            var gridViewC = _this.gridViewC.nativeElement;
            _this.slideView.content = (_this.slidesView = gridViewC);
            setTimeout(function () {
                for (var i = 1; i < _this.slideCount; i++) {
                    _this.slidesView.getChildAt(i).opacity = 0;
                }
                _this.listeQuestion.forEach(function (item) {
                    var ii = 0;
                    _this.onSwipe(2, 10);
                    console.log(ii++);
                }, 50);
                console.log(_this.currentSlideNum);
            });
        }, function (error) {
            console.log("error question");
        });
        //---------------------------//
        this.page.actionBarHidden = true;
        this.page.cssClasses.add("welcome-page-background");
        this.page.backgroundSpanUnderStatusBar = true;
    };
    //-------------------------------//
    QuestionComponent.prototype.onProgressBarLoaded = function (args) {
        var myProgressBar = args.object;
        myProgressBar.value = 10;
        myProgressBar.maxValue = 200;
        setInterval(function () {
            myProgressBar.value += 4;
        }, 100);
    };
    QuestionComponent.prototype.onValueChanged = function (args) {
        var _this = this;
        var myProgressBar = args.object;
        console.log("Old Value: " + args.oldValue);
        console.log("New Value: " + args.value);
        if (args.value == 200) {
            this.showSlideQuestion = true;
            var gridMain = this.gridMain.nativeElement;
            gridMain.height = 10000;
            //------------time circulation --------//
            var timeM = setInterval(function () {
                _this.timeQCM -= 1;
                _this.timeSecond = 60;
                if (_this.timeQCM == 0) {
                    clearInterval(timeM);
                }
            }, 60000);
            var timeS = setInterval(function () {
                _this.timeSecond -= 1;
                if (_this.timeQCM == 0)
                    clearInterval(timeS);
            }, 1000);
        }
    };
    //-------------------------------//
    QuestionComponent.prototype.onSwipe = function (direction, duree) {
        var prevSlideNum = this.currentSlideNum;
        var count = this.slideCount;
        if (direction == 2) {
            this.currentSlideNum = (this.currentSlideNum + 1) % count;
        }
        else if (direction == 1) {
            this.currentSlideNum = (this.currentSlideNum - 1 + count) % count;
        }
        else {
            // We are interested in left and right directions
            return;
        }
        var currSlide = this.slidesView.getChildAt(prevSlideNum);
        var nextSlide = this.slidesView.getChildAt(this.currentSlideNum);
        console.log(this.currentSlideNum);
        this.animate(currSlide, nextSlide, direction, duree);
    };
    QuestionComponent.prototype.animate = function (currSlide, nextSlide, direction, duree) {
        nextSlide.translateX = (direction == 2 ? this.screenWidth : -this.screenWidth);
        nextSlide.opacity = 1;
        var definitions = new Array();
        var defn1 = {
            target: currSlide,
            translate: { x: (direction == 2 ? -this.screenWidth : this.screenWidth), y: 0 },
            duration: duree
        };
        definitions.push(defn1);
        var defn2 = {
            target: nextSlide,
            translate: { x: 0, y: 0 },
            duration: duree
        };
        definitions.push(defn2);
        var animationSet = new animation_1.Animation(definitions);
        animationSet.play()
            .then(function () {
            console.log("Animation finished");
        })
            .catch(function (e) {
            console.log(e.message);
        });
    };
    QuestionComponent.prototype.getSliderItemClass = function (item) {
        if (item == this.currentSlideNum)
            return "caro-item-dot-selected";
        return "caro-item-dot";
    };
    QuestionComponent.prototype.getTypeQuestion = function (quest) {
        var nbR = 0;
        var nbJ = 0;
        if (quest.rep1 != null)
            nbR += 1;
        if (quest.rep2 != null)
            nbR += 1;
        if (quest.rep3 != null)
            nbR += 1;
        if (quest.rep4 != null)
            nbR += 1;
        if (quest.rep5 != null)
            nbR += 1;
        if (quest.rep6 != null)
            nbR += 1;
        if (quest.just1 != "0")
            nbJ += 1;
        if (quest.just2 != "0")
            nbJ += 1;
        if (quest.just3 != "0")
            nbJ += 1;
        if (quest.just4 != "0")
            nbJ += 1;
        if (quest.just5 != "0")
            nbJ += 1;
        if (quest.just6 != "0")
            nbJ += 1;
        if (nbR == 1 && nbJ == 1)
            return { type: "t", nPro: nbR };
        else if (nbR > 1 && nbJ == 1)
            return { type: "r", nPro: nbR };
        return { type: "c", nPro: nbR };
    };
    //------Radio Button--------/
    QuestionComponent.prototype.changeCheckedRadio = function (idQ, txtR) {
        console.log(idQ + "  " + txtR);
        for (var i = 0; i < this.radioOptions.length; i++)
            if (this.radioOptions[i].idQue == idQ && this.radioOptions[i].txtRep == txtR)
                this.radioOptions[i].selected = true;
            else if (this.radioOptions[i].idQue == idQ && this.radioOptions[i].txtRep != txtR)
                this.radioOptions[i].selected = false;
        console.log(this.radioOptions);
    };
    QuestionComponent.prototype.elatRadio = function (idQ, txtR) {
        for (var i = 0; i < this.radioOptions.length; i++)
            if (this.radioOptions[i].idQue == idQ && this.radioOptions[i].txtRep == txtR)
                return this.radioOptions[i].selected || false;
        return false;
    };
    QuestionComponent.prototype.onCheckBoxTap = function () {
        console.log("aaaaaa");
    };
    __decorate([
        core_1.ViewChild('slideContent'),
        __metadata("design:type", core_1.ElementRef)
    ], QuestionComponent.prototype, "slideElement", void 0);
    __decorate([
        core_1.ViewChild('gridViewC'),
        __metadata("design:type", core_1.ElementRef)
    ], QuestionComponent.prototype, "gridViewC", void 0);
    __decorate([
        core_1.ViewChild('gridMain'),
        __metadata("design:type", core_1.ElementRef)
    ], QuestionComponent.prototype, "gridMain", void 0);
    QuestionComponent = __decorate([
        core_1.Component({
            selector: "question",
            moduleId: module.id,
            templateUrl: "./question.component.html",
            styleUrls: ["./question.component.css"]
        }),
        __metadata("design:paramtypes", [page_1.Page,
            router_1.RouterExtensions,
            router_2.ActivatedRoute,
            question_slides_service_1.QuestionSlidesService])
    ], QuestionComponent);
    return QuestionComponent;
}());
exports.QuestionComponent = QuestionComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVlc3Rpb24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicXVlc3Rpb24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQWdGO0FBQ2hGLHNEQUErRDtBQUUvRCxnQ0FBa0Q7QUFHbEQsMENBQThEO0FBQzlELHFDQUFxRDtBQUdyRCxpQ0FBbUM7QUFJbkMscUVBQWtFO0FBQ2xFLDBDQUFpRDtBQUdqRCxrREFBaUQ7QUFHakQsNERBQTBEO0FBRzFELG1HQUF1RjtBQVV2RjtJQXNCSSwyQkFDWSxJQUFVLEVBQ1YsR0FBcUIsRUFDckIsY0FBOEIsRUFDOUIsZUFBc0M7UUFIdEMsU0FBSSxHQUFKLElBQUksQ0FBTTtRQUNWLFFBQUcsR0FBSCxHQUFHLENBQWtCO1FBQ3JCLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUM5QixvQkFBZSxHQUFmLGVBQWUsQ0FBdUI7UUF2QmxELGNBQVMsR0FBRyxlQUFNLENBQUM7UUFHbkIsaUJBQVksR0FBRyxFQUFFLENBQUM7UUFDbEIsc0JBQWlCLEdBQUcsS0FBSyxDQUFDO1FBSW5CLG9CQUFlLEdBQVcsQ0FBQyxDQUFDO1FBaUIvQixJQUFJLENBQUMsV0FBVyxHQUFHLGlCQUFNLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQztRQUUvQyxrREFBa0Q7UUFDbEQsSUFBSSxvQkFBUyxJQUFJLGlCQUFNLENBQUMsVUFBVSxJQUFJLElBQUksRUFBRTtZQUN4QyxJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztZQUM3QixJQUFJLE1BQU0sR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUNuRCxNQUFNLENBQUMsaUJBQWlCLENBQUMsUUFBUSxDQUFDLENBQUM7WUFFbkMsSUFBSSxTQUFTLEdBQUcsTUFBTSxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQ3RDLFNBQVMsQ0FBQyxxQkFBcUIsQ0FDM0IsSUFB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R0FBbEIsVUFBbUIsR0FBRyxFQUFFLElBQUk7UUFDeEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQyxDQUFBO1FBRTlCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUU7WUFDN0MsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLElBQUksSUFBSTtnQkFDeEUsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO2lCQUNwQyxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxJQUFJLEdBQUcsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sSUFBSSxJQUFJO2dCQUM3RSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUM7UUFFOUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUE7SUFDbEMsQ0FBQztJQUNELHFDQUFTLEdBQVQsVUFBVSxHQUFHLEVBQUUsSUFBSTtRQUNmLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUU7WUFDN0MsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLElBQUksSUFBSTtnQkFDeEUsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsSUFBSSxLQUFLLENBQUM7UUFDdEQsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQztJQUVELHlDQUFhLEdBQWI7UUFDSSxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFBO0lBQ3pCLENBQUM7SUFyTzBCO1FBQTFCLGdCQUFTLENBQUMsY0FBYyxDQUFDO2tDQUFlLGlCQUFVOzJEQUFDO0lBQzVCO1FBQXZCLGdCQUFTLENBQUMsV0FBVyxDQUFDO2tDQUFZLGlCQUFVO3dEQUFDO0lBQ3ZCO1FBQXRCLGdCQUFTLENBQUMsVUFBVSxDQUFDO2tDQUFXLGlCQUFVO3VEQUFDO0lBbkJuQyxpQkFBaUI7UUFON0IsZ0JBQVMsQ0FBQztZQUNQLFFBQVEsRUFBRSxVQUFVO1lBQ3BCLFFBQVEsRUFBRSxNQUFNLENBQUMsRUFBRTtZQUNuQixXQUFXLEVBQUUsMkJBQTJCO1lBQ3hDLFNBQVMsRUFBRSxDQUFDLDBCQUEwQixDQUFDO1NBQzFDLENBQUM7eUNBd0JvQixXQUFJO1lBQ0wseUJBQWdCO1lBQ0wsdUJBQWM7WUFDYiwrQ0FBcUI7T0ExQnpDLGlCQUFpQixDQXVQN0I7SUFBRCx3QkFBQztDQUFBLEFBdlBELElBdVBDO0FBdlBZLDhDQUFpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBWaWV3Q2hpbGQsIEVsZW1lbnRSZWYsIElucHV0IH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuaW1wb3J0IHsgUm91dGVyRXh0ZW5zaW9ucyB9IGZyb20gXCJuYXRpdmVzY3JpcHQtYW5ndWxhci9yb3V0ZXJcIjtcclxuXHJcbmltcG9ydCB7IFBhZ2UsIENvbnRlbnRWaWV3LCBWaWV3IH0gZnJvbSBcInVpL3BhZ2VcIjtcclxuaW1wb3J0IHsgU3dpcGVHZXN0dXJlRXZlbnREYXRhIH0gZnJvbSBcInVpL2dlc3R1cmVzL2dlc3R1cmVzXCI7XHJcbmltcG9ydCB7IEdyaWRMYXlvdXQsIEdyaWRVbml0VHlwZSwgSXRlbVNwZWMgfSBmcm9tIFwidWkvbGF5b3V0cy9ncmlkLWxheW91dFwiO1xyXG5pbXBvcnQgeyBBbmltYXRpb25EZWZpbml0aW9uLCBBbmltYXRpb24gfSBmcm9tICd1aS9hbmltYXRpb24nO1xyXG5pbXBvcnQgeyBzY3JlZW4sIGlzQW5kcm9pZCwgZGV2aWNlIH0gZnJvbSBcInBsYXRmb3JtXCI7XHJcblxyXG5cclxuaW1wb3J0ICogYXMgYXBwIGZyb20gXCJhcHBsaWNhdGlvblwiO1xyXG5pbXBvcnQgKiBhcyBmcyBmcm9tIFwiZmlsZS1zeXN0ZW1cIjtcclxuaW1wb3J0ICogYXMgYnVpbGRlciBmcm9tIFwidWkvYnVpbGRlclwiO1xyXG5cclxuaW1wb3J0IHsgUXVlc3Rpb25TbGlkZXNTZXJ2aWNlIH0gZnJvbSBcIi4vcXVlc3Rpb24tc2xpZGVzLnNlcnZpY2VcIjtcclxuaW1wb3J0IHsgQWN0aXZhdGVkUm91dGUgfSBmcm9tIFwiQGFuZ3VsYXIvcm91dGVyXCI7XHJcbmltcG9ydCB7IFN0YWNrTGF5b3V0IH0gZnJvbSBcInRucy1jb3JlLW1vZHVsZXMvdWkvbGF5b3V0cy9zdGFjay1sYXlvdXQvc3RhY2stbGF5b3V0XCI7XHJcbmltcG9ydCB7IFF1ZXN0aW9uIH0gZnJvbSBcIi4uLy4uL3NlcnZpY2VzL3F1ZXN0aW9uXCI7XHJcbmltcG9ydCB7IENvbmZpZyB9IGZyb20gXCIuLi8uLi9wYXJhbWV0ZXJzL2NvbmZpZ1wiO1xyXG5cclxuXHJcbmltcG9ydCB7IFJhZGlvT3B0aW9uIH0gZnJvbSBcIi4uLy4uL3NlcnZpY2VzL3JhZGlvLW9wdGlvblwiO1xyXG5cclxuaW1wb3J0IHsgUHJvZ3Jlc3MgfSBmcm9tIFwidG5zLWNvcmUtbW9kdWxlcy91aS9wcm9ncmVzc1wiO1xyXG5pbXBvcnQgeyBnZXRTdHJpbmcgfSBmcm9tIFwidG5zLWNvcmUtbW9kdWxlcy9hcHBsaWNhdGlvbi1zZXR0aW5ncy9hcHBsaWNhdGlvbi1zZXR0aW5nc1wiO1xyXG5cclxuZGVjbGFyZSB2YXIgYW5kcm9pZDogYW55O1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogXCJxdWVzdGlvblwiLFxyXG4gICAgbW9kdWxlSWQ6IG1vZHVsZS5pZCxcclxuICAgIHRlbXBsYXRlVXJsOiBcIi4vcXVlc3Rpb24uY29tcG9uZW50Lmh0bWxcIixcclxuICAgIHN0eWxlVXJsczogW1wiLi9xdWVzdGlvbi5jb21wb25lbnQuY3NzXCJdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBRdWVzdGlvbkNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiAgICAvLy0tLS0tLS0tLS0tLS0tLy9cclxuICAgIGxpc3RlUXVlc3Rpb246IFF1ZXN0aW9uW107XHJcbiAgICBwYXRoSW1hZ2UgPSBDb25maWc7XHJcbiAgICB0aW1lUUNNO1xyXG4gICAgdGltZVNlY29uZDtcclxuICAgIHJhZGlvT3B0aW9ucyA9IFtdO1xyXG4gICAgc2hvd1NsaWRlUXVlc3Rpb24gPSBmYWxzZTtcclxuICAgIGRpY3Rpb25heWpzb247XHJcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS8vXHJcbiAgICBwdWJsaWMgaWRfdGVzdDtcclxuICAgIHB1YmxpYyBjdXJyZW50U2xpZGVOdW06IG51bWJlciA9IDA7XHJcbiAgICBwcml2YXRlIHNsaWRlQ291bnQ6IG51bWJlcjtcclxuXHJcbiAgICBwcml2YXRlIHNjcmVlbldpZHRoO1xyXG4gICAgcHJpdmF0ZSBzbGlkZXNWaWV3OiBHcmlkTGF5b3V0O1xyXG5cclxuICAgIEBWaWV3Q2hpbGQoJ3NsaWRlQ29udGVudCcpIHNsaWRlRWxlbWVudDogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ2dyaWRWaWV3QycpIGdyaWRWaWV3QzogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ2dyaWRNYWluJykgZ3JpZE1haW46IEVsZW1lbnRSZWY7XHJcbiAgICBwcml2YXRlIHNsaWRlVmlldzogQ29udGVudFZpZXc7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBwYWdlOiBQYWdlLFxyXG4gICAgICAgIHByaXZhdGUgbmF2OiBSb3V0ZXJFeHRlbnNpb25zLFxyXG4gICAgICAgIHByaXZhdGUgYWN0aXZhdGVkUm91dGU6IEFjdGl2YXRlZFJvdXRlLFxyXG4gICAgICAgIHByaXZhdGUgcXVlc3Rpb25TZXJ2aWNlOiBRdWVzdGlvblNsaWRlc1NlcnZpY2VcclxuICAgICkge1xyXG4gICAgICAgIHRoaXMuc2NyZWVuV2lkdGggPSBzY3JlZW4ubWFpblNjcmVlbi53aWR0aERJUHM7XHJcblxyXG4gICAgICAgIC8vIFNwYW4gdGhlIGJhY2tncm91bmQgdW5kZXIgc3RhdHVzIGJhciBvbiBBbmRyb2lkXHJcbiAgICAgICAgaWYgKGlzQW5kcm9pZCAmJiBkZXZpY2Uuc2RrVmVyc2lvbiA+PSAnMjEnKSB7XHJcbiAgICAgICAgICAgIHZhciBWaWV3ID0gYW5kcm9pZC52aWV3LlZpZXc7XHJcbiAgICAgICAgICAgIHZhciB3aW5kb3cgPSBhcHAuYW5kcm9pZC5zdGFydEFjdGl2aXR5LmdldFdpbmRvdygpO1xyXG4gICAgICAgICAgICB3aW5kb3cuc2V0U3RhdHVzQmFyQ29sb3IoMHgwMDAwMDApO1xyXG5cclxuICAgICAgICAgICAgdmFyIGRlY29yVmlldyA9IHdpbmRvdy5nZXREZWNvclZpZXcoKTtcclxuICAgICAgICAgICAgZGVjb3JWaWV3LnNldFN5c3RlbVVpVmlzaWJpbGl0eShcclxuICAgICAgICAgICAgICAgIFZpZXcuU1lTVEVNX1VJX0ZMQUdfTEFZT1VUX1NUQUJMRVxyXG4gICAgICAgICAgICAgICAgfCBWaWV3LlNZU1RFTV9VSV9GTEFHX0xBWU9VVF9ISURFX05BVklHQVRJT05cclxuICAgICAgICAgICAgICAgIHwgVmlldy5TWVNURU1fVUlfRkxBR19MQVlPVVRfRlVMTFNDUkVFTlxyXG4gICAgICAgICAgICAgICAgfCBWaWV3LlNZU1RFTV9VSV9GTEFHX0lNTUVSU0lWRV9TVElDS1kpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpIHtcclxuICAgICAgICB0aGlzLmRpY3Rpb25heWpzb24gPSByZXF1aXJlKENvbmZpZy5kaWN0aW9uYXJ5VXJsKTtcclxuICAgICAgICB0aGlzLmlkX3Rlc3QgPSB0aGlzLmFjdGl2YXRlZFJvdXRlLnNuYXBzaG90LnBhcmFtTWFwLmdldCgnaWRfdGVzdCcpO1xyXG4gICAgICAgIHRoaXMudGltZVFDTSA9IGdldFN0cmluZyhcInRlc3RfZHVyZWVfcHJlXCIpO1xyXG4gICAgICAgIHRoaXMudGltZVNlY29uZD02MDtcclxuICAgICAgICBsZXQgZ3JpZE1haW46IEdyaWRMYXlvdXQgPSB0aGlzLmdyaWRNYWluLm5hdGl2ZUVsZW1lbnQgYXMgR3JpZExheW91dDtcclxuICAgICAgICBncmlkTWFpbi5oZWlnaHQgPSAwXHJcbiAgICAgICAgdGhpcy5xdWVzdGlvblNlcnZpY2UuZ2V0TGlzdFF1ZXN0aW9ucyh0aGlzLmlkX3Rlc3QpLnN1YnNjcmliZShcclxuICAgICAgICAgICAgZGF0YSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxpc3RlUXVlc3Rpb24gPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zbGlkZUNvdW50ID0gdGhpcy5saXN0ZVF1ZXN0aW9uLmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgICAgICAvLy0tLS0tLS0tLVJhZGlvQnV0dG9uLS0tLS0tLS0tLS0vL1xyXG4gICAgICAgICAgICAgICAgdGhpcy5saXN0ZVF1ZXN0aW9uLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2V0VHlwZVF1ZXN0aW9uKGl0ZW0pLnR5cGUgPT0gJ3InKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmFkaW9PcHRpb25zXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucHVzaChuZXcgUmFkaW9PcHRpb24oaXRlbS5pZCwgaXRlbS5yZXAxLCBmYWxzZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJhZGlvT3B0aW9uc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnB1c2gobmV3IFJhZGlvT3B0aW9uKGl0ZW0uaWQsIGl0ZW0ucmVwMiwgZmFsc2UpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yYWRpb09wdGlvbnNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5wdXNoKG5ldyBSYWRpb09wdGlvbihpdGVtLmlkLCBpdGVtLnJlcDMsIGZhbHNlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmFkaW9PcHRpb25zXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucHVzaChuZXcgUmFkaW9PcHRpb24oaXRlbS5pZCwgaXRlbS5yZXA0LCBmYWxzZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJhZGlvT3B0aW9uc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnB1c2gobmV3IFJhZGlvT3B0aW9uKGl0ZW0uaWQsIGl0ZW0ucmVwNSwgZmFsc2UpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yYWRpb09wdGlvbnNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5wdXNoKG5ldyBSYWRpb09wdGlvbihpdGVtLmlkLCBpdGVtLnJlcDYsIGZhbHNlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0vL1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zbGlkZVZpZXcgPSB0aGlzLnNsaWRlRWxlbWVudC5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgICAgICAgICAgbGV0IGdyaWRWaWV3QzogR3JpZExheW91dCA9IHRoaXMuZ3JpZFZpZXdDLm5hdGl2ZUVsZW1lbnQgYXMgR3JpZExheW91dDtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2xpZGVWaWV3LmNvbnRlbnQgPSAodGhpcy5zbGlkZXNWaWV3ID0gZ3JpZFZpZXdDKTtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgdGhpcy5zbGlkZUNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zbGlkZXNWaWV3LmdldENoaWxkQXQoaSkub3BhY2l0eSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxpc3RlUXVlc3Rpb24uZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGlpID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vblN3aXBlKDIsIDEwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhpaSsrKVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB9LCA1MCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMuY3VycmVudFNsaWRlTnVtKVxyXG4gICAgICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3IgcXVlc3Rpb25cIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICApO1xyXG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLy9cclxuICAgICAgICB0aGlzLnBhZ2UuYWN0aW9uQmFySGlkZGVuID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnBhZ2UuY3NzQ2xhc3Nlcy5hZGQoXCJ3ZWxjb21lLXBhZ2UtYmFja2dyb3VuZFwiKTtcclxuICAgICAgICB0aGlzLnBhZ2UuYmFja2dyb3VuZFNwYW5VbmRlclN0YXR1c0JhciA9IHRydWU7XHJcblxyXG5cclxuICAgIH1cclxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS8vXHJcblxyXG4gICAgb25Qcm9ncmVzc0JhckxvYWRlZChhcmdzKSB7XHJcbiAgICAgICAgbGV0IG15UHJvZ3Jlc3NCYXIgPSA8UHJvZ3Jlc3M+YXJncy5vYmplY3Q7XHJcblxyXG4gICAgICAgIG15UHJvZ3Jlc3NCYXIudmFsdWUgPSAxMDtcclxuICAgICAgICBteVByb2dyZXNzQmFyLm1heFZhbHVlID0gMjAwO1xyXG5cclxuICAgICAgICBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIG15UHJvZ3Jlc3NCYXIudmFsdWUgKz0gNDtcclxuICAgICAgICB9LCAxMDApO1xyXG4gICAgfVxyXG5cclxuICAgIG9uVmFsdWVDaGFuZ2VkKGFyZ3MpIHtcclxuICAgICAgICBsZXQgbXlQcm9ncmVzc0JhciA9IDxQcm9ncmVzcz5hcmdzLm9iamVjdDtcclxuXHJcbiAgICAgICAgY29uc29sZS5sb2coXCJPbGQgVmFsdWU6IFwiICsgYXJncy5vbGRWYWx1ZSk7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJOZXcgVmFsdWU6IFwiICsgYXJncy52YWx1ZSk7XHJcbiAgICAgICAgaWYgKGFyZ3MudmFsdWUgPT0gMjAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvd1NsaWRlUXVlc3Rpb24gPSB0cnVlO1xyXG4gICAgICAgICAgICBsZXQgZ3JpZE1haW46IEdyaWRMYXlvdXQgPSB0aGlzLmdyaWRNYWluLm5hdGl2ZUVsZW1lbnQgYXMgR3JpZExheW91dDtcclxuICAgICAgICAgICAgZ3JpZE1haW4uaGVpZ2h0ID0gMTAwMDA7XHJcbiAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tdGltZSBjaXJjdWxhdGlvbiAtLS0tLS0tLS8vXHJcbiAgICAgICAgICAgIHZhciB0aW1lTSA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGltZVFDTSAtPSAxO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50aW1lU2Vjb25kID02MDtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnRpbWVRQ00gPT0gMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aW1lTSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfSwgNjAwMDApO1xyXG5cclxuICAgICAgICAgICAgdmFyIHRpbWVTID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50aW1lU2Vjb25kIC09IDE7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy50aW1lUUNNID09IDApXHJcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aW1lUyk7XHJcbiAgICAgICAgICAgIH0sIDEwMDApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0vL1xyXG4gICAgb25Td2lwZShkaXJlY3Rpb246IG51bWJlciwgZHVyZWU6IG51bWJlcikge1xyXG5cclxuICAgICAgICBsZXQgcHJldlNsaWRlTnVtID0gdGhpcy5jdXJyZW50U2xpZGVOdW07XHJcbiAgICAgICAgbGV0IGNvdW50ID0gdGhpcy5zbGlkZUNvdW50O1xyXG5cclxuICAgICAgICBpZiAoZGlyZWN0aW9uID09IDIpIHtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50U2xpZGVOdW0gPSAodGhpcy5jdXJyZW50U2xpZGVOdW0gKyAxKSAlIGNvdW50O1xyXG4gICAgICAgIH0gZWxzZSBpZiAoZGlyZWN0aW9uID09IDEpIHtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50U2xpZGVOdW0gPSAodGhpcy5jdXJyZW50U2xpZGVOdW0gLSAxICsgY291bnQpICUgY291bnQ7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gV2UgYXJlIGludGVyZXN0ZWQgaW4gbGVmdCBhbmQgcmlnaHQgZGlyZWN0aW9uc1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBjdXJyU2xpZGUgPSB0aGlzLnNsaWRlc1ZpZXcuZ2V0Q2hpbGRBdChwcmV2U2xpZGVOdW0pO1xyXG4gICAgICAgIGNvbnN0IG5leHRTbGlkZSA9IHRoaXMuc2xpZGVzVmlldy5nZXRDaGlsZEF0KHRoaXMuY3VycmVudFNsaWRlTnVtKTtcclxuXHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5jdXJyZW50U2xpZGVOdW0pO1xyXG4gICAgICAgIHRoaXMuYW5pbWF0ZShjdXJyU2xpZGUsIG5leHRTbGlkZSwgZGlyZWN0aW9uLCBkdXJlZSk7XHJcbiAgICB9XHJcblxyXG4gICAgYW5pbWF0ZShjdXJyU2xpZGUsIG5leHRTbGlkZSwgZGlyZWN0aW9uLCBkdXJlZSkge1xyXG4gICAgICAgIG5leHRTbGlkZS50cmFuc2xhdGVYID0gKGRpcmVjdGlvbiA9PSAyID8gdGhpcy5zY3JlZW5XaWR0aCA6IC10aGlzLnNjcmVlbldpZHRoKTtcclxuICAgICAgICBuZXh0U2xpZGUub3BhY2l0eSA9IDE7XHJcbiAgICAgICAgdmFyIGRlZmluaXRpb25zID0gbmV3IEFycmF5PEFuaW1hdGlvbkRlZmluaXRpb24+KCk7XHJcbiAgICAgICAgdmFyIGRlZm4xOiBBbmltYXRpb25EZWZpbml0aW9uID0ge1xyXG4gICAgICAgICAgICB0YXJnZXQ6IGN1cnJTbGlkZSxcclxuICAgICAgICAgICAgdHJhbnNsYXRlOiB7IHg6IChkaXJlY3Rpb24gPT0gMiA/IC10aGlzLnNjcmVlbldpZHRoIDogdGhpcy5zY3JlZW5XaWR0aCksIHk6IDAgfSxcclxuICAgICAgICAgICAgZHVyYXRpb246IGR1cmVlXHJcbiAgICAgICAgfTtcclxuICAgICAgICBkZWZpbml0aW9ucy5wdXNoKGRlZm4xKTtcclxuXHJcbiAgICAgICAgdmFyIGRlZm4yOiBBbmltYXRpb25EZWZpbml0aW9uID0ge1xyXG4gICAgICAgICAgICB0YXJnZXQ6IG5leHRTbGlkZSxcclxuICAgICAgICAgICAgdHJhbnNsYXRlOiB7IHg6IDAsIHk6IDAgfSxcclxuICAgICAgICAgICAgZHVyYXRpb246IGR1cmVlXHJcbiAgICAgICAgfTtcclxuICAgICAgICBkZWZpbml0aW9ucy5wdXNoKGRlZm4yKTtcclxuXHJcbiAgICAgICAgdmFyIGFuaW1hdGlvblNldCA9IG5ldyBBbmltYXRpb24oZGVmaW5pdGlvbnMpO1xyXG4gICAgICAgIGFuaW1hdGlvblNldC5wbGF5KClcclxuICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJBbmltYXRpb24gZmluaXNoZWRcIik7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGdldFNsaWRlckl0ZW1DbGFzcyhpdGVtOiBudW1iZXIpIHtcclxuICAgICAgICBpZiAoaXRlbSA9PSB0aGlzLmN1cnJlbnRTbGlkZU51bSlcclxuICAgICAgICAgICAgcmV0dXJuIFwiY2Fyby1pdGVtLWRvdC1zZWxlY3RlZFwiO1xyXG5cclxuICAgICAgICByZXR1cm4gXCJjYXJvLWl0ZW0tZG90XCI7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VHlwZVF1ZXN0aW9uKHF1ZXN0KSB7XHJcbiAgICAgICAgbGV0IG5iUiA9IDA7XHJcbiAgICAgICAgbGV0IG5iSiA9IDA7XHJcblxyXG4gICAgICAgIGlmIChxdWVzdC5yZXAxICE9IG51bGwpIG5iUiArPSAxXHJcbiAgICAgICAgaWYgKHF1ZXN0LnJlcDIgIT0gbnVsbCkgbmJSICs9IDFcclxuICAgICAgICBpZiAocXVlc3QucmVwMyAhPSBudWxsKSBuYlIgKz0gMVxyXG4gICAgICAgIGlmIChxdWVzdC5yZXA0ICE9IG51bGwpIG5iUiArPSAxXHJcbiAgICAgICAgaWYgKHF1ZXN0LnJlcDUgIT0gbnVsbCkgbmJSICs9IDFcclxuICAgICAgICBpZiAocXVlc3QucmVwNiAhPSBudWxsKSBuYlIgKz0gMVxyXG5cclxuICAgICAgICBpZiAocXVlc3QuanVzdDEgIT0gXCIwXCIpIG5iSiArPSAxXHJcbiAgICAgICAgaWYgKHF1ZXN0Lmp1c3QyICE9IFwiMFwiKSBuYkogKz0gMVxyXG4gICAgICAgIGlmIChxdWVzdC5qdXN0MyAhPSBcIjBcIikgbmJKICs9IDFcclxuICAgICAgICBpZiAocXVlc3QuanVzdDQgIT0gXCIwXCIpIG5iSiArPSAxXHJcbiAgICAgICAgaWYgKHF1ZXN0Lmp1c3Q1ICE9IFwiMFwiKSBuYkogKz0gMVxyXG4gICAgICAgIGlmIChxdWVzdC5qdXN0NiAhPSBcIjBcIikgbmJKICs9IDFcclxuICAgICAgICBpZiAobmJSID09IDEgJiYgbmJKID09IDEpIHJldHVybiB7IHR5cGU6IFwidFwiLCBuUHJvOiBuYlIgfVxyXG4gICAgICAgIGVsc2UgaWYgKG5iUiA+IDEgJiYgbmJKID09IDEpIHJldHVybiB7IHR5cGU6IFwiclwiLCBuUHJvOiBuYlIgfVxyXG4gICAgICAgIHJldHVybiB7IHR5cGU6IFwiY1wiLCBuUHJvOiBuYlIgfVxyXG4gICAgfVxyXG4gICAgLy8tLS0tLS1SYWRpbyBCdXR0b24tLS0tLS0tLS9cclxuICAgIGNoYW5nZUNoZWNrZWRSYWRpbyhpZFEsIHR4dFIpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhpZFEgKyBcIiAgXCIgKyB0eHRSKVxyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucmFkaW9PcHRpb25zLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICBpZiAodGhpcy5yYWRpb09wdGlvbnNbaV0uaWRRdWUgPT0gaWRRICYmIHRoaXMucmFkaW9PcHRpb25zW2ldLnR4dFJlcCA9PSB0eHRSKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5yYWRpb09wdGlvbnNbaV0uc2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLnJhZGlvT3B0aW9uc1tpXS5pZFF1ZSA9PSBpZFEgJiYgdGhpcy5yYWRpb09wdGlvbnNbaV0udHh0UmVwICE9IHR4dFIpXHJcbiAgICAgICAgICAgICAgICB0aGlzLnJhZGlvT3B0aW9uc1tpXS5zZWxlY3RlZCA9IGZhbHNlO1xyXG5cclxuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLnJhZGlvT3B0aW9ucylcclxuICAgIH1cclxuICAgIGVsYXRSYWRpbyhpZFEsIHR4dFIpOiBib29sZWFuIHtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucmFkaW9PcHRpb25zLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICBpZiAodGhpcy5yYWRpb09wdGlvbnNbaV0uaWRRdWUgPT0gaWRRICYmIHRoaXMucmFkaW9PcHRpb25zW2ldLnR4dFJlcCA9PSB0eHRSKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmFkaW9PcHRpb25zW2ldLnNlbGVjdGVkIHx8IGZhbHNlO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBvbkNoZWNrQm94VGFwKCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiYWFhYWFhXCIpXHJcbiAgICB9XHJcbn0iXX0=