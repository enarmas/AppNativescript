"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var router_1 = require("nativescript-angular/router");
var page_1 = require("ui/page");
var animation_1 = require("ui/animation");
var platform_1 = require("platform");
var app = require("application");
var question_slides_service_1 = require("./question-slides.service");
var router_2 = require("@angular/router");
var config_1 = require("../../parameters/config");
var QuestionComponent = /** @class */ (function () {
    function QuestionComponent(page, nav, activatedRoute, questionService) {
        this.page = page;
        this.nav = nav;
        this.activatedRoute = activatedRoute;
        this.questionService = questionService;
        this.pathImage = config_1.Config;
        this.currentSlideNum = 0;
        this.slideCount = 3;
        this.screenWidth = platform_1.screen.mainScreen.widthDIPs;
        // Span the background under status bar on Android
        if (platform_1.isAndroid && platform_1.device.sdkVersion >= '21') {
            var View = android.view.View;
            var window = app.android.startActivity.getWindow();
            window.setStatusBarColor(0x000000);
            var decorView = window.getDecorView();
            decorView.setSystemUiVisibility(View.SYSTEM_UI_FLAG_LAYOUT_STABLE
                | View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION
                | View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN
                | View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY);
        }
    }
    QuestionComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.id_test = this.activatedRoute.snapshot.paramMap.get('id_test');
        this.questionService.getListQuestions(this.id_test).subscribe(function (data) {
            _this.listeQuestion = data;
            _this.slideCount = _this.listeQuestion.length;
            console.log("zaher mizyan question");
            console.log(_this.listeQuestion);
            _this.slideView = _this.slideElement.nativeElement;
            var gridViewC = _this.gridViewC.nativeElement;
            _this.slideView.content = (_this.slidesView = gridViewC);
            setTimeout(function () {
                for (var i = 1; i < _this.slideCount; i++)
                    _this.slidesView.getChildAt(i).opacity = 0;
            }, 50);
        }, function (error) {
            console.log("error question");
        });
        //---------------------------//
        this.page.actionBarHidden = true;
        this.page.cssClasses.add("welcome-page-background");
        this.page.backgroundSpanUnderStatusBar = true;
    };
    QuestionComponent.prototype.skipIntro = function () {
        // this.nav.navigate(["/home"], { clearHistory: true });
        // this.nav.navigate(["/home"]);
    };
    QuestionComponent.prototype.onSwipe = function (args) {
        var prevSlideNum = this.currentSlideNum;
        var count = this.slideCount;
        if (args.direction == 2) {
            this.currentSlideNum = (this.currentSlideNum + 1) % count;
        }
        else if (args.direction == 1) {
            this.currentSlideNum = (this.currentSlideNum - 1 + count) % count;
        }
        else {
            // We are interested in left and right directions
            return;
        }
        var currSlide = this.slidesView.getChildAt(prevSlideNum);
        var nextSlide = this.slidesView.getChildAt(this.currentSlideNum);
        this.animate(currSlide, nextSlide, args.direction);
    };
    QuestionComponent.prototype.animate = function (currSlide, nextSlide, direction) {
        nextSlide.translateX = (direction == 2 ? this.screenWidth : -this.screenWidth);
        nextSlide.opacity = 1;
        console.log(nextSlide);
        console.log(nextSlide.opacity);
        var definitions = new Array();
        var defn1 = {
            target: currSlide,
            translate: { x: (direction == 2 ? -this.screenWidth : this.screenWidth), y: 0 },
            duration: 500
        };
        definitions.push(defn1);
        var defn2 = {
            target: nextSlide,
            translate: { x: 0, y: 0 },
            duration: 500
        };
        definitions.push(defn2);
        var animationSet = new animation_1.Animation(definitions);
        animationSet.play()
            .then(function () {
            console.log("Animation finished");
        })
            .catch(function (e) {
            console.log(e.message);
        });
    };
    QuestionComponent.prototype.itemSelected = function (item) {
        console.log(item);
    };
    QuestionComponent.prototype.getSliderItemClass = function (item) {
        /*if (item == this.currentSlideNum)
            return "caro-item-dot caro-item-dot-selected";

        return "caro-item-dot";*/
    };
    QuestionComponent.prototype.getTypeQuestion = function (quest) {
        var nbR = 0;
        var nbJ = 0;
        if (quest.rep1 != null)
            nbR += 1;
        if (quest.rep2 != null)
            nbR += 1;
        if (quest.rep3 != null)
            nbR += 1;
        if (quest.rep4 != null)
            nbR += 1;
        if (quest.rep5 != null)
            nbR += 1;
        if (quest.rep6 != null)
            nbR += 1;
        if (quest.just1 != "0")
            nbJ += 1;
        if (quest.just2 != "0")
            nbJ += 1;
        if (quest.just3 != "0")
            nbJ += 1;
        if (quest.just4 != "0")
            nbJ += 1;
        if (quest.just5 != "0")
            nbJ += 1;
        if (quest.just6 != "0")
            nbJ += 1;
        if (nbR == 1 && nbJ == 1)
            return { type: "t", nPro: nbR };
        else if (nbR > 1 && nbJ == 1)
            return { type: "r", nPro: nbR };
        return { type: "c", nPro: nbR };
    };
    __decorate([
        core_1.ViewChild('slideContent'),
        __metadata("design:type", core_1.ElementRef)
    ], QuestionComponent.prototype, "slideElement", void 0);
    __decorate([
        core_1.ViewChild('gridViewC'),
        __metadata("design:type", core_1.ElementRef)
    ], QuestionComponent.prototype, "gridViewC", void 0);
    QuestionComponent = __decorate([
        core_1.Component({
            selector: "question",
            moduleId: module.id,
            templateUrl: "./question.component.html",
            styleUrls: ["./question.component.css"]
        }),
        __metadata("design:paramtypes", [page_1.Page,
            router_1.RouterExtensions,
            router_2.ActivatedRoute,
            question_slides_service_1.QuestionSlidesService])
    ], QuestionComponent);
    return QuestionComponent;
}());
exports.QuestionComponent = QuestionComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVlc3Rpb24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicXVlc3Rpb24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQWdGO0FBQ2hGLHNEQUErRDtBQUUvRCxnQ0FBa0Q7QUFHbEQsMENBQThEO0FBQzlELHFDQUFxRDtBQUdyRCxpQ0FBbUM7QUFJbkMscUVBQWtFO0FBQ2xFLDBDQUFpRDtBQUdqRCxrREFBaUQ7QUFVakQ7SUFrQkksMkJBQ1ksSUFBVSxFQUNWLEdBQXFCLEVBQ3JCLGNBQThCLEVBQzlCLGVBQXNDO1FBSHRDLFNBQUksR0FBSixJQUFJLENBQU07UUFDVixRQUFHLEdBQUgsR0FBRyxDQUFrQjtRQUNyQixtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFDOUIsb0JBQWUsR0FBZixlQUFlLENBQXVCO1FBbkJsRCxjQUFTLEdBQUcsZUFBTSxDQUFDO1FBS1gsb0JBQWUsR0FBVyxDQUFDLENBQUM7UUFDNUIsZUFBVSxHQUFHLENBQUMsQ0FBQztRQWVuQixJQUFJLENBQUMsV0FBVyxHQUFHLGlCQUFNLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQztRQUUvQyxrREFBa0Q7UUFDbEQsSUFBSSxvQkFBUyxJQUFJLGlCQUFNLENBQUMsVUFBVSxJQUFJLElBQUksRUFBRTtZQUN4QyxJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztZQUM3QixJQUFJLE1BQU0sR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUNuRCxNQUFNLENBQUMsaUJBQWlCLENBQUMsUUFBUSxDQUFDLENBQUM7WUFFbkMsSUFBSSxTQUFTLEdBQUcsTUFBTSxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQ3RDLFNBQVMsQ0FBQyxxQkFBcUIsQ0FDM0IsSUFBSSxDQUFDLDRCQUE0QjtrQkFDL0IsSUFBSSxDQUFDLHFDQUFxQztrQkFDMUMsSUFBSSxDQUFDLGdD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QUUsR0FBRyxJQUFHLENBQUMsQ0FBQTtRQUM1QixJQUFHLEtBQUssQ0FBQyxLQUFLLElBQUUsR0FBRztZQUFFLEdBQUcsSUFBRyxDQUFDLENBQUE7UUFDNUIsSUFBRyxLQUFLLENBQUMsS0FBSyxJQUFFLEdBQUc7WUFBRSxHQUFHLElBQUcsQ0FBQyxDQUFBO1FBQzVCLElBQUksR0FBRyxJQUFFLENBQUMsSUFBSSxHQUFHLElBQUUsQ0FBQztZQUFFLE9BQU8sRUFBQyxJQUFJLEVBQUMsR0FBRyxFQUFDLElBQUksRUFBQyxHQUFHLEVBQUMsQ0FBQTthQUMzQyxJQUFJLEdBQUcsR0FBQyxDQUFDLElBQUksR0FBRyxJQUFFLENBQUM7WUFBRSxPQUFPLEVBQUMsSUFBSSxFQUFDLEdBQUcsRUFBQyxJQUFJLEVBQUMsR0FBRyxFQUFDLENBQUE7UUFDcEQsT0FBTyxFQUFDLElBQUksRUFBQyxHQUFHLEVBQUMsSUFBSSxFQUFDLEdBQUcsRUFBQyxDQUFBO0lBQzlCLENBQUM7SUFoSjBCO1FBQTFCLGdCQUFTLENBQUMsY0FBYyxDQUFDO2tDQUFlLGlCQUFVOzJEQUFDO0lBQzVCO1FBQXZCLGdCQUFTLENBQUMsV0FBVyxDQUFDO2tDQUFZLGlCQUFVO3dEQUFDO0lBZnJDLGlCQUFpQjtRQU43QixnQkFBUyxDQUFDO1lBQ1AsUUFBUSxFQUFFLFVBQVU7WUFDcEIsUUFBUSxFQUFFLE1BQU0sQ0FBQyxFQUFFO1lBQ25CLFdBQVcsRUFBRSwyQkFBMkI7WUFDeEMsU0FBUyxFQUFFLENBQUMsMEJBQTBCLENBQUM7U0FDMUMsQ0FBQzt5Q0FvQm9CLFdBQUk7WUFDTCx5QkFBZ0I7WUFDTCx1QkFBYztZQUNiLCtDQUFxQjtPQXRCekMsaUJBQWlCLENBK0o3QjtJQUFELHdCQUFDO0NBQUEsQUEvSkQsSUErSkM7QUEvSlksOENBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIFZpZXdDaGlsZCwgRWxlbWVudFJlZiwgSW5wdXQgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHsgUm91dGVyRXh0ZW5zaW9ucyB9IGZyb20gXCJuYXRpdmVzY3JpcHQtYW5ndWxhci9yb3V0ZXJcIjtcblxuaW1wb3J0IHsgUGFnZSwgQ29udGVudFZpZXcsIFZpZXcgfSBmcm9tIFwidWkvcGFnZVwiO1xuaW1wb3J0IHsgU3dpcGVHZXN0dXJlRXZlbnREYXRhIH0gZnJvbSBcInVpL2dlc3R1cmVzL2dlc3R1cmVzXCI7XG5pbXBvcnQgeyBHcmlkTGF5b3V0LCBHcmlkVW5pdFR5cGUsIEl0ZW1TcGVjIH0gZnJvbSBcInVpL2xheW91dHMvZ3JpZC1sYXlvdXRcIjtcbmltcG9ydCB7IEFuaW1hdGlvbkRlZmluaXRpb24sIEFuaW1hdGlvbiB9IGZyb20gJ3VpL2FuaW1hdGlvbic7XG5pbXBvcnQgeyBzY3JlZW4sIGlzQW5kcm9pZCwgZGV2aWNlIH0gZnJvbSBcInBsYXRmb3JtXCI7XG5cblxuaW1wb3J0ICogYXMgYXBwIGZyb20gXCJhcHBsaWNhdGlvblwiO1xuaW1wb3J0ICogYXMgZnMgZnJvbSBcImZpbGUtc3lzdGVtXCI7XG5pbXBvcnQgKiBhcyBidWlsZGVyIGZyb20gXCJ1aS9idWlsZGVyXCI7XG5cbmltcG9ydCB7IFF1ZXN0aW9uU2xpZGVzU2VydmljZSB9IGZyb20gXCIuL3F1ZXN0aW9uLXNsaWRlcy5zZXJ2aWNlXCI7XG5pbXBvcnQgeyBBY3RpdmF0ZWRSb3V0ZSB9IGZyb20gXCJAYW5ndWxhci9yb3V0ZXJcIjtcbmltcG9ydCB7IFN0YWNrTGF5b3V0IH0gZnJvbSBcInRucy1jb3JlLW1vZHVsZXMvdWkvbGF5b3V0cy9zdGFjay1sYXlvdXQvc3RhY2stbGF5b3V0XCI7XG5pbXBvcnQge1F1ZXN0aW9ufSBmcm9tIFwiLi4vLi4vc2VydmljZXMvcXVlc3Rpb25cIjtcbmltcG9ydCB7IENvbmZpZyB9IGZyb20gXCIuLi8uLi9wYXJhbWV0ZXJzL2NvbmZpZ1wiO1xuXG5kZWNsYXJlIHZhciBhbmRyb2lkOiBhbnk7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiBcInF1ZXN0aW9uXCIsXG4gICAgbW9kdWxlSWQ6IG1vZHVsZS5pZCxcbiAgICB0ZW1wbGF0ZVVybDogXCIuL3F1ZXN0aW9uLmNvbXBvbmVudC5odG1sXCIsXG4gICAgc3R5bGVVcmxzOiBbXCIuL3F1ZXN0aW9uLmNvbXBvbmVudC5jc3NcIl1cbn0pXG5leHBvcnQgY2xhc3MgUXVlc3Rpb25Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICAgIC8vLS0tLS0tLS0tLS0tLS0vL1xuICAgIGxpc3RlUXVlc3Rpb246UXVlc3Rpb25bXSA7XG4gICAgcGF0aEltYWdlID0gQ29uZmlnO1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLy9cbiAgICAvLyBwcml2YXRlIHNsaWRlc1BhdGggPSAncGFnZXMvcXVlc3Rpb24vc2xpZGVzJztcbiAgICAvLyBwcml2YXRlIHNsaWRlRmlsZXMgPSBbJ3NsaWRlMS54bWwnLCAnc2xpZGUyLnhtbCcsICdzbGlkZTMueG1sJ107XG4gICAgcHVibGljIGlkX3Rlc3Q7XG4gICAgcHJpdmF0ZSBjdXJyZW50U2xpZGVOdW06IG51bWJlciA9IDA7XG4gICAgcHJpdmF0ZSBzbGlkZUNvdW50ID0gMztcblxuICAgIHByaXZhdGUgc2NyZWVuV2lkdGg7XG4gICAgcHJpdmF0ZSBzbGlkZXNWaWV3OiBHcmlkTGF5b3V0O1xuXG4gICAgQFZpZXdDaGlsZCgnc2xpZGVDb250ZW50Jykgc2xpZGVFbGVtZW50OiBFbGVtZW50UmVmO1xuICAgIEBWaWV3Q2hpbGQoJ2dyaWRWaWV3QycpIGdyaWRWaWV3QzogRWxlbWVudFJlZjtcbiAgICBwcml2YXRlIHNsaWRlVmlldzogQ29udGVudFZpZXc7XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSBwYWdlOiBQYWdlLFxuICAgICAgICBwcml2YXRlIG5hdjogUm91dGVyRXh0ZW5zaW9ucyxcbiAgICAgICAgcHJpdmF0ZSBhY3RpdmF0ZWRSb3V0ZTogQWN0aXZhdGVkUm91dGUsXG4gICAgICAgIHByaXZhdGUgcXVlc3Rpb25TZXJ2aWNlOiBRdWVzdGlvblNsaWRlc1NlcnZpY2VcbiAgICApIHtcbiAgICAgICAgdGhpcy5zY3JlZW5XaWR0aCA9IHNjcmVlbi5tYWluU2NyZWVuLndpZHRoRElQcztcblxuICAgICAgICAvLyBTcGFuIHRoZSBiYWNrZ3JvdW5kIHVuZGVyIHN0YXR1cyBiYXIgb24gQW5kcm9pZFxuICAgICAgICBpZiAoaXNBbmRyb2lkICYmIGRldmljZS5zZGtWZXJzaW9uID49ICcyMScpIHtcbiAgICAgICAgICAgIHZhciBWaWV3ID0gYW5kcm9pZC52aWV3LlZpZXc7XG4gICAgICAgICAgICB2YXIgd2luZG93ID0gYXBwLmFuZHJvaWQuc3RhcnRBY3Rpdml0eS5nZXRXaW5kb3coKTtcbiAgICAgICAgICAgIHdpbmRvdy5zZXRTdGF0dXNCYXJDb2xvcigweDAwMDAwMCk7XG5cbiAgICAgICAgICAgIHZhciBkZWNvclZpZXcgPSB3aW5kb3cuZ2V0RGVjb3JWaWV3KCk7XG4gICAgICAgICAgICBkZWNvclZpZXcuc2V0U3lzdGVtVWlWaXNpYmlsaXR5KFxuICAgICAgICAgICAgICAgIFZpZXcuU1lTVEVNX1VJX0ZMQUdfTEFZT1VUX1NUQUJMRVxuICAgICAgICAgICAgICAgIHwgVmlldy5TWVNURU1fVUlfRkxBR19MQVlPVVRfSElERV9OQVZJR0FUSU9OXG4gICAgICAgICAgICAgICAgfCBWaWV3LlNZU1RFTV9VSV9GTEFHX0xBWU9VVF9GVUxMU0NSRUVOXG4gICAgICAgICAgICAgICAgfCBWaWV3LlNZU1RFTV9VSV9GTEFHX0lNTUVSU0lWRV9TVElDS1kpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMuaWRfdGVzdCA9IHRoaXMuYWN0aXZhdGVkUm91dGUuc25hcHNob3QucGFyYW1NYXAuZ2V0KCdpZF90ZXN0Jyk7XG4gICAgICAgIHRoaXMucXVlc3Rpb25TZXJ2aWNlLmdldExpc3RRdWVzdGlvbnModGhpcy5pZF90ZXN0KS5zdWJzY3JpYmUoXG4gICAgICAgICAgICBkYXRhID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmxpc3RlUXVlc3Rpb24gPSBkYXRhO1xuICAgICAgICAgICAgICAgIHRoaXMuc2xpZGVDb3VudCA9IHRoaXMubGlzdGVRdWVzdGlvbi5sZW5ndGg7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJ6YWhlciBtaXp5YW4gcXVlc3Rpb25cIilcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmxpc3RlUXVlc3Rpb24pXG4gICAgICAgICAgICAgICAgdGhpcy5zbGlkZVZpZXcgPSB0aGlzLnNsaWRlRWxlbWVudC5uYXRpdmVFbGVtZW50O1xuICAgICAgICAgICAgICAgIGxldCBncmlkVmlld0M6IEdyaWRMYXlvdXQgPSB0aGlzLmdyaWRWaWV3Qy5uYXRpdmVFbGVtZW50IGFzIEdyaWRMYXlvdXQ7XG4gICAgICAgICAgICAgICAgdGhpcy5zbGlkZVZpZXcuY29udGVudCA9ICh0aGlzLnNsaWRlc1ZpZXcgPSBncmlkVmlld0MpO1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHRoaXMuc2xpZGVDb3VudDsgaSsrKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zbGlkZXNWaWV3LmdldENoaWxkQXQoaSkub3BhY2l0eSA9IDA7XG4gICAgICAgICAgICAgICAgfSwgNTApXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3IgcXVlc3Rpb25cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLy9cbiAgICAgICAgdGhpcy5wYWdlLmFjdGlvbkJhckhpZGRlbiA9IHRydWU7XG4gICAgICAgIHRoaXMucGFnZS5jc3NDbGFzc2VzLmFkZChcIndlbGNvbWUtcGFnZS1iYWNrZ3JvdW5kXCIpO1xuICAgICAgICB0aGlzLnBhZ2UuYmFja2dyb3VuZFNwYW5VbmRlclN0YXR1c0JhciA9IHRydWU7XG5cbiAgICB9XG5cbiAgICBza2lwSW50cm8oKSB7XG4gICAgICAgIC8vIHRoaXMubmF2Lm5hdmlnYXRlKFtcIi9ob21lXCJdLCB7IGNsZWFySGlzdG9yeTogdHJ1ZSB9KTtcbiAgICAgICAgLy8gdGhpcy5uYXYubmF2aWdhdGUoW1wiL2hvbWVcIl0pO1xuICAgIH1cblxuICAgIG9uU3dpcGUoYXJnczogU3dpcGVHZXN0dXJlRXZlbnREYXRhKSB7XG5cbiAgICAgICAgbGV0IHByZXZTbGlkZU51bSA9IHRoaXMuY3VycmVudFNsaWRlTnVtO1xuICAgICAgICBsZXQgY291bnQgPSB0aGlzLnNsaWRlQ291bnQ7XG5cbiAgICAgICAgaWYgKGFyZ3MuZGlyZWN0aW9uID09IDIpIHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFNsaWRlTnVtID0gKHRoaXMuY3VycmVudFNsaWRlTnVtICsgMSkgJSBjb3VudDtcbiAgICAgICAgfSBlbHNlIGlmIChhcmdzLmRpcmVjdGlvbiA9PSAxKSB7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRTbGlkZU51bSA9ICh0aGlzLmN1cnJlbnRTbGlkZU51bSAtIDEgKyBjb3VudCkgJSBjb3VudDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIFdlIGFyZSBpbnRlcmVzdGVkIGluIGxlZnQgYW5kIHJpZ2h0IGRpcmVjdGlvbnNcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGN1cnJTbGlkZSA9IHRoaXMuc2xpZGVzVmlldy5nZXRDaGlsZEF0KHByZXZTbGlkZU51bSk7XG4gICAgICAgIGNvbnN0IG5leHRTbGlkZSA9IHRoaXMuc2xpZGVzVmlldy5nZXRDaGlsZEF0KHRoaXMuY3VycmVudFNsaWRlTnVtKTtcblxuXG4gICAgICAgIHRoaXMuYW5pbWF0ZShjdXJyU2xpZGUsIG5leHRTbGlkZSwgYXJncy5kaXJlY3Rpb24pO1xuICAgIH1cblxuICAgIGFuaW1hdGUoY3VyclNsaWRlLCBuZXh0U2xpZGUsIGRpcmVjdGlvbikge1xuXG4gICAgICAgIG5leHRTbGlkZS50cmFuc2xhdGVYID0gKGRpcmVjdGlvbiA9PSAyID8gdGhpcy5zY3JlZW5XaWR0aCA6IC10aGlzLnNjcmVlbldpZHRoKTtcblxuICAgICAgICBuZXh0U2xpZGUub3BhY2l0eSA9IDE7XG4gICAgICAgIGNvbnNvbGUubG9nKG5leHRTbGlkZSlcbiAgICAgICAgY29uc29sZS5sb2cobmV4dFNsaWRlLm9wYWNpdHkpXG4gICAgICAgIHZhciBkZWZpbml0aW9ucyA9IG5ldyBBcnJheTxBbmltYXRpb25EZWZpbml0aW9uPigpO1xuICAgICAgICB2YXIgZGVmbjE6IEFuaW1hdGlvbkRlZmluaXRpb24gPSB7XG4gICAgICAgICAgICB0YXJnZXQ6IGN1cnJTbGlkZSxcbiAgICAgICAgICAgIHRyYW5zbGF0ZTogeyB4OiAoZGlyZWN0aW9uID09IDIgPyAtdGhpcy5zY3JlZW5XaWR0aCA6IHRoaXMuc2NyZWVuV2lkdGgpLCB5OiAwIH0sXG4gICAgICAgICAgICBkdXJhdGlvbjogNTAwXG4gICAgICAgIH07XG4gICAgICAgIGRlZmluaXRpb25zLnB1c2goZGVmbjEpO1xuXG4gICAgICAgIHZhciBkZWZuMjogQW5pbWF0aW9uRGVmaW5pdGlvbiA9IHtcbiAgICAgICAgICAgIHRhcmdldDogbmV4dFNsaWRlLFxuICAgICAgICAgICAgdHJhbnNsYXRlOiB7IHg6IDAsIHk6IDAgfSxcbiAgICAgICAgICAgIGR1cmF0aW9uOiA1MDBcbiAgICAgICAgfTtcbiAgICAgICAgZGVmaW5pdGlvbnMucHVzaChkZWZuMik7XG5cbiAgICAgICAgdmFyIGFuaW1hdGlvblNldCA9IG5ldyBBbmltYXRpb24oZGVmaW5pdGlvbnMpO1xuICAgICAgICBhbmltYXRpb25TZXQucGxheSgpXG4gICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJBbmltYXRpb24gZmluaXNoZWRcIik7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZS5tZXNzYWdlKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIGl0ZW1TZWxlY3RlZChpdGVtOiBudW1iZXIpIHtcblxuICAgICAgICBjb25zb2xlLmxvZyhpdGVtKVxuICAgIH1cblxuICAgIGdldFNsaWRlckl0ZW1DbGFzcyhpdGVtOiBudW1iZXIpIHtcbiAgICAgICAgLyppZiAoaXRlbSA9PSB0aGlzLmN1cnJlbnRTbGlkZU51bSlcbiAgICAgICAgICAgIHJldHVybiBcImNhcm8taXRlbS1kb3QgY2Fyby1pdGVtLWRvdC1zZWxlY3RlZFwiO1xuXG4gICAgICAgIHJldHVybiBcImNhcm8taXRlbS1kb3RcIjsqL1xuICAgIH1cblxuICAgIGdldFR5cGVRdWVzdGlvbihxdWVzdCl7XG4gICAgICAgICBsZXQgbmJSID0gMDtcbiAgICAgICAgIGxldCBuYkogPSAwO1xuXG4gICAgICAgIGlmKHF1ZXN0LnJlcDEhPW51bGwpIG5iUiArPTFcbiAgICAgICAgaWYocXVlc3QucmVwMiE9bnVsbCkgbmJSICs9MVxuICAgICAgICBpZihxdWVzdC5yZXAzIT1udWxsKSBuYlIgKz0xXG4gICAgICAgIGlmKHF1ZXN0LnJlcDQhPW51bGwpIG5iUiArPTFcbiAgICAgICAgaWYocXVlc3QucmVwNSE9bnVsbCkgbmJSICs9MVxuICAgICAgICBpZihxdWVzdC5yZXA2IT1udWxsKSBuYlIgKz0xXG5cbiAgICAgICAgaWYocXVlc3QuanVzdDEhPVwiMFwiKSBuYkogKz0xXG4gICAgICAgIGlmKHF1ZXN0Lmp1c3QyIT1cIjBcIikgbmJKICs9MVxuICAgICAgICBpZihxdWVzdC5qdXN0MyE9XCIwXCIpIG5iSiArPTFcbiAgICAgICAgaWYocXVlc3QuanVzdDQhPVwiMFwiKSBuYkogKz0xXG4gICAgICAgIGlmKHF1ZXN0Lmp1c3Q1IT1cIjBcIikgbmJKICs9MVxuICAgICAgICBpZihxdWVzdC5qdXN0NiE9XCIwXCIpIG5iSiArPTFcbiAgICAgICAgaWYgKG5iUj09MSAmJiBuYko9PTEpIHJldHVybiB7dHlwZTpcInRcIixuUHJvOm5iUn1cbiAgICAgICAgZWxzZSBpZiAobmJSPjEgJiYgbmJKPT0xKSByZXR1cm4ge3R5cGU6XCJyXCIsblBybzpuYlJ9XG4gICAgICAgIHJldHVybiB7dHlwZTpcImNcIixuUHJvOm5iUn1cbiAgICB9XG59Il19